<!-- HTML generated by Yang Ye --><div style="background: #ffffff; overflow:auto;width:auto;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span></span><span style="color: #888888"># Time:  O(n * 4^n / n^(3/2)) ~= n * Catalan numbers = n * (C(2n, n) - C(2n, n - 1)), </span>
<span style="color: #888888">#                                due to the size of the results is Catalan numbers,</span>
<span style="color: #888888">#                                and every way of evaluation is the length of the string,</span>
<span style="color: #888888">#                                so the time complexity is at most n * Catalan numbers.</span>
<span style="color: #888888"># Space: O(n * 4^n / n^(3/2)), the cache size of lookup is at most n * Catalan numbers.</span>
<span style="color: #888888">#</span>
<span style="color: #888888"># Given a string of numbers and operators, return all possible</span>
<span style="color: #888888"># results from computing all the different possible ways to</span>
<span style="color: #888888"># group numbers and operators. The valid operators are +, - and *.</span>
<span style="color: #888888">#</span>
<span style="color: #888888">#</span>
<span style="color: #888888"># Example 1</span>
<span style="color: #888888"># Input: &quot;2-1-1&quot;.</span>
<span style="color: #888888">#</span>
<span style="color: #888888"># ((2-1)-1) = 0</span>
<span style="color: #888888"># (2-(1-1)) = 2</span>
<span style="color: #888888"># Output: [0, 2]</span>
<span style="color: #888888">#</span>
<span style="color: #888888">#</span>
<span style="color: #888888"># Example 2</span>
<span style="color: #888888"># Input: &quot;2*3-4*5&quot;</span>
<span style="color: #888888">#</span>
<span style="color: #888888"># (2*(3-(4*5))) = -34</span>
<span style="color: #888888"># ((2*3)-(4*5)) = -14</span>
<span style="color: #888888"># ((2*(3-4))*5) = -10</span>
<span style="color: #888888"># (2*((3-4)*5)) = -10</span>
<span style="color: #888888"># (((2*3)-4)*5) = 10</span>
<span style="color: #888888"># Output: [-34, -14, -10, -10, 10]</span>
<span style="color: #888888">#</span>

<span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">Solution</span>:
    <span style="color: #888888"># @param {string} input</span>
    <span style="color: #888888"># @return {integer[]}</span>
    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">diffWaysToCompute</span>(<span style="color: #007020">self</span>, <span style="color: #007020">input</span>):
        tokens <span style="color: #333333">=</span> re<span style="color: #333333">.</span>split(<span style="background-color: #fff0f0">&#39;(\D)&#39;</span>, <span style="color: #007020">input</span>)
        nums <span style="color: #333333">=</span> <span style="color: #007020">map</span>(<span style="color: #007020">int</span>, tokens[::<span style="color: #0000DD; font-weight: bold">2</span>])
        ops <span style="color: #333333">=</span> <span style="color: #007020">map</span>({<span style="background-color: #fff0f0">&#39;+&#39;</span>: operator<span style="color: #333333">.</span>add, <span style="background-color: #fff0f0">&#39;-&#39;</span>: operator<span style="color: #333333">.</span>sub, <span style="background-color: #fff0f0">&#39;*&#39;</span>: operator<span style="color: #333333">.</span>mul}<span style="color: #333333">.</span>get, tokens[<span style="color: #0000DD; font-weight: bold">1</span>::<span style="color: #0000DD; font-weight: bold">2</span>])
        lookup <span style="color: #333333">=</span> [[<span style="color: #007020">None</span> <span style="color: #008800; font-weight: bold">for</span> _ <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">xrange</span>(<span style="color: #007020">len</span>(nums))] <span style="color: #008800; font-weight: bold">for</span> _ <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">xrange</span>(<span style="color: #007020">len</span>(nums))]
        
        <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">diffWaysToComputeRecu</span>(left, right):
            <span style="color: #008800; font-weight: bold">if</span> left <span style="color: #333333">==</span> right:
                <span style="color: #008800; font-weight: bold">return</span> [nums[left]]
            <span style="color: #008800; font-weight: bold">if</span> lookup[left][right]:
                <span style="color: #008800; font-weight: bold">return</span> lookup[left][right]
            lookup[left][right] <span style="color: #333333">=</span> [ops[i](x, y)
                                   <span style="color: #008800; font-weight: bold">for</span> i <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">xrange</span>(left, right)
                                   <span style="color: #008800; font-weight: bold">for</span> x <span style="color: #000000; font-weight: bold">in</span> diffWaysToComputeRecu(left, i)
                                   <span style="color: #008800; font-weight: bold">for</span> y <span style="color: #000000; font-weight: bold">in</span> diffWaysToComputeRecu(i <span style="color: #333333">+</span> <span style="color: #0000DD; font-weight: bold">1</span>, right)]
            <span style="color: #008800; font-weight: bold">return</span> lookup[left][right]
            
        <span style="color: #008800; font-weight: bold">return</span> diffWaysToComputeRecu(<span style="color: #0000DD; font-weight: bold">0</span>, <span style="color: #007020">len</span>(nums) <span style="color: #333333">-</span> <span style="color: #0000DD; font-weight: bold">1</span>)

<span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">Solution2</span>:
    <span style="color: #888888"># @param {string} input</span>
    <span style="color: #888888"># @return {integer[]}</span>
    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">diffWaysToCompute</span>(<span style="color: #007020">self</span>, <span style="color: #007020">input</span>):
        lookup <span style="color: #333333">=</span> [[<span style="color: #007020">None</span> <span style="color: #008800; font-weight: bold">for</span> _ <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">xrange</span>(<span style="color: #007020">len</span>(<span style="color: #007020">input</span>) <span style="color: #333333">+</span> <span style="color: #0000DD; font-weight: bold">1</span>)] <span style="color: #008800; font-weight: bold">for</span> _ <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">xrange</span>(<span style="color: #007020">len</span>(<span style="color: #007020">input</span>) <span style="color: #333333">+</span> <span style="color: #0000DD; font-weight: bold">1</span>)]
        ops <span style="color: #333333">=</span> {<span style="background-color: #fff0f0">&#39;+&#39;</span>: operator<span style="color: #333333">.</span>add, <span style="background-color: #fff0f0">&#39;-&#39;</span>: operator<span style="color: #333333">.</span>sub, <span style="background-color: #fff0f0">&#39;*&#39;</span>: operator<span style="color: #333333">.</span>mul}

        <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">diffWaysToComputeRecu</span>(left, right):
            <span style="color: #008800; font-weight: bold">if</span> lookup[left][right]:
                <span style="color: #008800; font-weight: bold">return</span> lookup[left][right]
            result <span style="color: #333333">=</span> []
            <span style="color: #008800; font-weight: bold">for</span> i <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">xrange</span>(left, right):
                <span style="color: #008800; font-weight: bold">if</span> <span style="color: #007020">input</span>[i] <span style="color: #000000; font-weight: bold">in</span> ops:
                    <span style="color: #008800; font-weight: bold">for</span> x <span style="color: #000000; font-weight: bold">in</span> diffWaysToComputeRecu(left, i):
                        <span style="color: #008800; font-weight: bold">for</span> y <span style="color: #000000; font-weight: bold">in</span> diffWaysToComputeRecu(i <span style="color: #333333">+</span> <span style="color: #0000DD; font-weight: bold">1</span>, right):
                            result<span style="color: #333333">.</span>append(ops[<span style="color: #007020">input</span>[i]](x, y))
            
            <span style="color: #008800; font-weight: bold">if</span> <span style="color: #000000; font-weight: bold">not</span> result:
                result <span style="color: #333333">=</span> [<span style="color: #007020">int</span>(<span style="color: #007020">input</span>[left:right])]
            lookup[left][right] <span style="color: #333333">=</span> result     
            <span style="color: #008800; font-weight: bold">return</span> lookup[left][right]
            
        <span style="color: #008800; font-weight: bold">return</span> diffWaysToComputeRecu(<span style="color: #0000DD; font-weight: bold">0</span>, <span style="color: #007020">len</span>(<span style="color: #007020">input</span>))
</pre></div>
