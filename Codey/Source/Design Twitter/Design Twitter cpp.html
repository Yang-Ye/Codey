<!-- HTML generated by Yang Ye --><div style="background: #ffffff; overflow:auto;width:auto;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span></span><span style="color: #888888">// Time:  O(klogu), k is most recently number of tweets,</span>
<span style="color: #888888">//                  u is the number of the user&#39;s following.</span>
<span style="color: #888888">// Space: O(t + f), t is the total number of tweets,</span>
<span style="color: #888888">//                  f is the total number of followings.</span>

<span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">Twitter</span> {
<span style="color: #008800; font-weight: bold">public</span><span style="color: #333333">:</span>
    <span style="color: #888888">/** Initialize your data structure here. */</span>
    Twitter() <span style="color: #333333">:</span> time_(<span style="color: #0000DD; font-weight: bold">0</span>) {
        
    }
    
    <span style="color: #888888">/** Compose a new tweet. */</span>
    <span style="color: #333399; font-weight: bold">void</span> postTweet(<span style="color: #333399; font-weight: bold">int</span> userId, <span style="color: #333399; font-weight: bold">int</span> tweetId) {
        messages_[userId].emplace_back(make_pair(<span style="color: #333333">++</span>time_, tweetId));
    }
    
    <span style="color: #888888">/** Retrieve the 10 most recent tweet ids in the user&#39;s news feed. Each item in the news feed must be posted by users who the user followed or by the user herself. Tweets must be ordered from most recent to least recent. */</span>
    vector<span style="color: #333333">&lt;</span><span style="color: #333399; font-weight: bold">int</span><span style="color: #333333">&gt;</span> getNewsFeed(<span style="color: #333399; font-weight: bold">int</span> userId) {
        <span style="color: #008800; font-weight: bold">using</span> RIT <span style="color: #333333">=</span> deque<span style="color: #333333">&lt;</span>pair<span style="color: #333333">&lt;</span><span style="color: #333399; font-weight: bold">size_t</span>, <span style="color: #333399; font-weight: bold">int</span><span style="color: #333333">&gt;&gt;::</span>reverse_iterator;
        priority_queue<span style="color: #333333">&lt;</span>tuple<span style="color: #333333">&lt;</span><span style="color: #333399; font-weight: bold">size_t</span>, RIT, RIT<span style="color: #333333">&gt;&gt;</span> heap;

        <span style="color: #008800; font-weight: bold">if</span> (messages_[userId].size()) {
            heap.emplace(make_tuple(messages_[userId].rbegin()<span style="color: #333333">-&gt;</span>first,
                                    messages_[userId].rbegin(),
                                    messages_[userId].rend()));
        }
        <span style="color: #008800; font-weight: bold">for</span> (<span style="color: #008800; font-weight: bold">const</span> <span style="color: #008800; font-weight: bold">auto</span><span style="color: #333333">&amp;</span> <span style="color: #997700; font-weight: bold">id</span> : followings_[userId]) {
            <span style="color: #008800; font-weight: bold">if</span> (messages_[id].size()) {
                heap.emplace(make_tuple(messages_[id].rbegin()<span style="color: #333333">-&gt;</span>first,
                                        messages_[id].rbegin(),
                                        messages_[id].rend()));
            }
        }
        vector<span style="color: #333333">&lt;</span><span style="color: #333399; font-weight: bold">int</span><span style="color: #333333">&gt;</span> res;
        <span style="color: #008800; font-weight: bold">while</span> (<span style="color: #333333">!</span>heap.empty() <span style="color: #333333">&amp;&amp;</span> res.size() <span style="color: #333333">&lt;</span> number_of_most_recent_tweets_) {
            <span style="color: #008800; font-weight: bold">const</span> <span style="color: #008800; font-weight: bold">auto</span><span style="color: #333333">&amp;</span> top <span style="color: #333333">=</span> heap.top();
            <span style="color: #333399; font-weight: bold">size_t</span> t;
            RIT begin, end;
            tie(t, begin, end) <span style="color: #333333">=</span> top;
            heap.pop();

            <span style="color: #008800; font-weight: bold">auto</span> next <span style="color: #333333">=</span> begin <span style="color: #333333">+</span> <span style="color: #0000DD; font-weight: bold">1</span>;
            <span style="color: #008800; font-weight: bold">if</span> (next <span style="color: #333333">!=</span> end) {
                heap.emplace(make_tuple(next<span style="color: #333333">-&gt;</span>first, next, end));
            }

            res.emplace_back(begin<span style="color: #333333">-&gt;</span>second);
        }
        <span style="color: #008800; font-weight: bold">return</span> res;
    }
    
    <span style="color: #888888">/** Follower follows a followee. If the operation is invalid, it should be a no-op. */</span>
    <span style="color: #333399; font-weight: bold">void</span> follow(<span style="color: #333399; font-weight: bold">int</span> followerId, <span style="color: #333399; font-weight: bold">int</span> followeeId) {
        <span style="color: #008800; font-weight: bold">if</span> (followerId <span style="color: #333333">!=</span> followeeId <span style="color: #333333">&amp;&amp;</span> <span style="color: #333333">!</span>followings_[followerId].count(followeeId)) {
            followings_[followerId].emplace(followeeId);
        }
    }
    
    <span style="color: #888888">/** Follower unfollows a followee. If the operation is invalid, it should be a no-op. */</span>
    <span style="color: #333399; font-weight: bold">void</span> unfollow(<span style="color: #333399; font-weight: bold">int</span> followerId, <span style="color: #333399; font-weight: bold">int</span> followeeId) {
        <span style="color: #008800; font-weight: bold">if</span> (followings_[followerId].count(followeeId)) {
            followings_[followerId].erase(followeeId);
        }
    }

<span style="color: #008800; font-weight: bold">private</span><span style="color: #333333">:</span>
    <span style="color: #008800; font-weight: bold">const</span> <span style="color: #333399; font-weight: bold">size_t</span> number_of_most_recent_tweets_ <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">10</span>;
    unordered_map<span style="color: #333333">&lt;</span><span style="color: #333399; font-weight: bold">int</span>, unordered_set<span style="color: #333333">&lt;</span><span style="color: #333399; font-weight: bold">int</span><span style="color: #333333">&gt;&gt;</span> followings_;
    unordered_map<span style="color: #333333">&lt;</span><span style="color: #333399; font-weight: bold">int</span>, deque<span style="color: #333333">&lt;</span>pair<span style="color: #333333">&lt;</span><span style="color: #333399; font-weight: bold">size_t</span>, <span style="color: #333399; font-weight: bold">int</span><span style="color: #333333">&gt;&gt;&gt;</span> messages_;
    <span style="color: #333399; font-weight: bold">size_t</span> time_;
};

<span style="color: #888888">/**</span>
<span style="color: #888888"> * Your Twitter object will be instantiated and called as such:</span>
<span style="color: #888888"> * Twitter obj = new Twitter();</span>
<span style="color: #888888"> * obj.postTweet(userId,tweetId);</span>
<span style="color: #888888"> * vector&lt;int&gt; param_2 = obj.getNewsFeed(userId);</span>
<span style="color: #888888"> * obj.follow(followerId,followeeId);</span>
<span style="color: #888888"> * obj.unfollow(followerId,followeeId);</span>
<span style="color: #888888"> */</span>
 
</pre></div>
