<!-- HTML generated by Yang Ye --><div style="background: #ffffff; overflow:auto;width:auto;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span></span><span style="color: #888888"># Time:  O(5^(n/2))</span>
<span style="color: #888888"># Space: O(n)</span>

<span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">Solution</span>:
    lookup <span style="color: #333333">=</span> {<span style="background-color: #fff0f0">&#39;0&#39;</span>:<span style="background-color: #fff0f0">&#39;0&#39;</span>, <span style="background-color: #fff0f0">&#39;1&#39;</span>:<span style="background-color: #fff0f0">&#39;1&#39;</span>, <span style="background-color: #fff0f0">&#39;6&#39;</span>:<span style="background-color: #fff0f0">&#39;9&#39;</span>, <span style="background-color: #fff0f0">&#39;8&#39;</span>:<span style="background-color: #fff0f0">&#39;8&#39;</span>, <span style="background-color: #fff0f0">&#39;9&#39;</span>:<span style="background-color: #fff0f0">&#39;6&#39;</span>}
    cache <span style="color: #333333">=</span> {}

    <span style="color: #888888"># @param {string} low</span>
    <span style="color: #888888"># @param {string} high</span>
    <span style="color: #888888"># @return {integer}</span>
    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">strobogrammaticInRange</span>(<span style="color: #007020">self</span>, low, high):
        count <span style="color: #333333">=</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>countStrobogrammaticUntil(high, <span style="color: #007020">False</span>) <span style="color: #333333">-</span> \
                <span style="color: #007020">self</span><span style="color: #333333">.</span>countStrobogrammaticUntil(low, <span style="color: #007020">False</span>) <span style="color: #333333">+</span> \
                <span style="color: #007020">self</span><span style="color: #333333">.</span>isStrobogrammatic(low)
        <span style="color: #008800; font-weight: bold">return</span> count <span style="color: #008800; font-weight: bold">if</span> count <span style="color: #333333">&gt;=</span> <span style="color: #0000DD; font-weight: bold">0</span> <span style="color: #008800; font-weight: bold">else</span> <span style="color: #0000DD; font-weight: bold">0</span>

    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">countStrobogrammaticUntil</span>(<span style="color: #007020">self</span>, num,  can_start_with_0):
        <span style="color: #008800; font-weight: bold">if</span> can_start_with_0 <span style="color: #000000; font-weight: bold">and</span> num <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>cache:
            <span style="color: #008800; font-weight: bold">return</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>cache[num]

        count <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">0</span>
        <span style="color: #008800; font-weight: bold">if</span> <span style="color: #007020">len</span>(num) <span style="color: #333333">==</span> <span style="color: #0000DD; font-weight: bold">1</span>:
            <span style="color: #008800; font-weight: bold">for</span> c <span style="color: #000000; font-weight: bold">in</span> [<span style="background-color: #fff0f0">&#39;0&#39;</span>, <span style="background-color: #fff0f0">&#39;1&#39;</span>, <span style="background-color: #fff0f0">&#39;8&#39;</span>]:
                <span style="color: #008800; font-weight: bold">if</span> num[<span style="color: #0000DD; font-weight: bold">0</span>] <span style="color: #333333">&gt;=</span> c:
                    count <span style="color: #333333">+=</span> <span style="color: #0000DD; font-weight: bold">1</span>
            <span style="color: #007020">self</span><span style="color: #333333">.</span>cache[num] <span style="color: #333333">=</span> count
            <span style="color: #008800; font-weight: bold">return</span> count
        
        <span style="color: #008800; font-weight: bold">for</span> key, val <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>lookup<span style="color: #333333">.</span>iteritems():
            <span style="color: #008800; font-weight: bold">if</span> can_start_with_0 <span style="color: #000000; font-weight: bold">or</span> key <span style="color: #333333">!=</span> <span style="background-color: #fff0f0">&#39;0&#39;</span>:
                <span style="color: #008800; font-weight: bold">if</span> num[<span style="color: #0000DD; font-weight: bold">0</span>] <span style="color: #333333">&gt;</span> key:
                    <span style="color: #008800; font-weight: bold">if</span> <span style="color: #007020">len</span>(num) <span style="color: #333333">==</span> <span style="color: #0000DD; font-weight: bold">2</span>:  <span style="color: #888888"># num is like &quot;21&quot;</span>
                        count <span style="color: #333333">+=</span> <span style="color: #0000DD; font-weight: bold">1</span>
                    <span style="color: #008800; font-weight: bold">else</span>:  <span style="color: #888888"># num is like &quot;201&quot;</span>
                        count <span style="color: #333333">+=</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>countStrobogrammaticUntil(<span style="background-color: #fff0f0">&#39;9&#39;</span> <span style="color: #333333">*</span> (<span style="color: #007020">len</span>(num) <span style="color: #333333">-</span> <span style="color: #0000DD; font-weight: bold">2</span>), <span style="color: #007020">True</span>)
                <span style="color: #008800; font-weight: bold">elif</span> num[<span style="color: #0000DD; font-weight: bold">0</span>] <span style="color: #333333">==</span> key:
                    <span style="color: #008800; font-weight: bold">if</span> <span style="color: #007020">len</span>(num) <span style="color: #333333">==</span> <span style="color: #0000DD; font-weight: bold">2</span>:  <span style="color: #888888"># num is like 12&quot;.</span>
                        <span style="color: #008800; font-weight: bold">if</span> num[<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span>] <span style="color: #333333">&gt;=</span> val:
                            count <span style="color: #333333">+=</span> <span style="color: #0000DD; font-weight: bold">1</span> 
                    <span style="color: #008800; font-weight: bold">else</span>:
                        <span style="color: #008800; font-weight: bold">if</span> num[<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span>] <span style="color: #333333">&gt;=</span> val:  <span style="color: #888888"># num is like &quot;102&quot;.</span>
                            count <span style="color: #333333">+=</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>countStrobogrammaticUntil(<span style="color: #007020">self</span><span style="color: #333333">.</span>getMid(num), <span style="color: #007020">True</span>);
                        <span style="color: #008800; font-weight: bold">elif</span> (<span style="color: #007020">self</span><span style="color: #333333">.</span>getMid(num) <span style="color: #333333">!=</span> <span style="background-color: #fff0f0">&#39;0&#39;</span> <span style="color: #333333">*</span> (<span style="color: #007020">len</span>(num) <span style="color: #333333">-</span> <span style="color: #0000DD; font-weight: bold">2</span>)):  <span style="color: #888888"># num is like &quot;110&quot;.</span>
                            count <span style="color: #333333">+=</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>countStrobogrammaticUntil(<span style="color: #007020">self</span><span style="color: #333333">.</span>getMid(num), <span style="color: #007020">True</span>) <span style="color: #333333">-</span> \
                                     <span style="color: #007020">self</span><span style="color: #333333">.</span>isStrobogrammatic(<span style="color: #007020">self</span><span style="color: #333333">.</span>getMid(num))

        <span style="color: #008800; font-weight: bold">if</span> <span style="color: #000000; font-weight: bold">not</span> can_start_with_0: <span style="color: #888888"># Sum up each length.</span>
            <span style="color: #008800; font-weight: bold">for</span> i <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">xrange</span>(<span style="color: #007020">len</span>(num) <span style="color: #333333">-</span> <span style="color: #0000DD; font-weight: bold">1</span>, <span style="color: #0000DD; font-weight: bold">0</span>, <span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span>):
                count <span style="color: #333333">+=</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>countStrobogrammaticByLength(i)
        <span style="color: #008800; font-weight: bold">else</span>:
            <span style="color: #007020">self</span><span style="color: #333333">.</span>cache[num] <span style="color: #333333">=</span> count

        <span style="color: #008800; font-weight: bold">return</span> count

    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">getMid</span>(<span style="color: #007020">self</span>, num):
        <span style="color: #008800; font-weight: bold">return</span> num[<span style="color: #0000DD; font-weight: bold">1</span>:<span style="color: #007020">len</span>(num) <span style="color: #333333">-</span> <span style="color: #0000DD; font-weight: bold">1</span>]

    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">countStrobogrammaticByLength</span>(<span style="color: #007020">self</span>, n):
        <span style="color: #008800; font-weight: bold">if</span> n <span style="color: #333333">==</span> <span style="color: #0000DD; font-weight: bold">1</span>:
            <span style="color: #008800; font-weight: bold">return</span> <span style="color: #0000DD; font-weight: bold">3</span>
        <span style="color: #008800; font-weight: bold">elif</span> n <span style="color: #333333">==</span> <span style="color: #0000DD; font-weight: bold">2</span>:
            <span style="color: #008800; font-weight: bold">return</span> <span style="color: #0000DD; font-weight: bold">4</span>
        <span style="color: #008800; font-weight: bold">elif</span> n <span style="color: #333333">==</span> <span style="color: #0000DD; font-weight: bold">3</span>:
            <span style="color: #008800; font-weight: bold">return</span> <span style="color: #0000DD; font-weight: bold">4</span> <span style="color: #333333">*</span> <span style="color: #0000DD; font-weight: bold">3</span>
        <span style="color: #008800; font-weight: bold">else</span>:
            <span style="color: #008800; font-weight: bold">return</span> <span style="color: #0000DD; font-weight: bold">5</span> <span style="color: #333333">*</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>countStrobogrammaticByLength(n <span style="color: #333333">-</span> <span style="color: #0000DD; font-weight: bold">2</span>)

    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">isStrobogrammatic</span>(<span style="color: #007020">self</span>, num):
        n <span style="color: #333333">=</span> <span style="color: #007020">len</span>(num)
        <span style="color: #008800; font-weight: bold">for</span> i <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">xrange</span>((n<span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">1</span>) <span style="color: #333333">/</span> <span style="color: #0000DD; font-weight: bold">2</span>):
            <span style="color: #008800; font-weight: bold">if</span> num[n<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span><span style="color: #333333">-</span>i] <span style="color: #000000; font-weight: bold">not</span> <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>lookup <span style="color: #000000; font-weight: bold">or</span> \
               num[i] <span style="color: #333333">!=</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>lookup[num[n<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span><span style="color: #333333">-</span>i]]:
                <span style="color: #008800; font-weight: bold">return</span> <span style="color: #007020">False</span>
        <span style="color: #008800; font-weight: bold">return</span> <span style="color: #007020">True</span>
</pre></div>
