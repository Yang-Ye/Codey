<!-- HTML generated by Yang Ye --><div style="background: #ffffff; overflow:auto;width:auto;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span></span><span style="color: #888888">// Time:  O(klog*k) ~= O(k), k is the length of the positions</span>
<span style="color: #888888">// Space: O(k)</span>

<span style="color: #888888">// Using unordered_map.</span>
<span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">Solution</span> {
<span style="color: #008800; font-weight: bold">public</span><span style="color: #333333">:</span>
    vector<span style="color: #333333">&lt;</span><span style="color: #333399; font-weight: bold">int</span><span style="color: #333333">&gt;</span> numIslands2(<span style="color: #333399; font-weight: bold">int</span> m, <span style="color: #333399; font-weight: bold">int</span> n, vector<span style="color: #333333">&lt;</span>pair<span style="color: #333333">&lt;</span><span style="color: #333399; font-weight: bold">int</span>, <span style="color: #333399; font-weight: bold">int</span><span style="color: #333333">&gt;&gt;&amp;</span> positions) {
        vector<span style="color: #333333">&lt;</span><span style="color: #333399; font-weight: bold">int</span><span style="color: #333333">&gt;</span> numbers;
        <span style="color: #333399; font-weight: bold">int</span> number <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">0</span>;
        <span style="color: #008800; font-weight: bold">const</span> vector<span style="color: #333333">&lt;</span>pair<span style="color: #333333">&lt;</span><span style="color: #333399; font-weight: bold">int</span>, <span style="color: #333399; font-weight: bold">int</span><span style="color: #333333">&gt;&gt;</span> directions{{<span style="color: #0000DD; font-weight: bold">0</span>, <span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span>}, {<span style="color: #0000DD; font-weight: bold">0</span>, <span style="color: #0000DD; font-weight: bold">1</span>},
                                                {<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span>, <span style="color: #0000DD; font-weight: bold">0</span>}, {<span style="color: #0000DD; font-weight: bold">1</span>, <span style="color: #0000DD; font-weight: bold">0</span>}};
        unordered_map<span style="color: #333333">&lt;</span><span style="color: #333399; font-weight: bold">int</span>, <span style="color: #333399; font-weight: bold">int</span><span style="color: #333333">&gt;</span> set;
        <span style="color: #008800; font-weight: bold">for</span> (<span style="color: #008800; font-weight: bold">const</span> <span style="color: #008800; font-weight: bold">auto</span><span style="color: #333333">&amp;</span> <span style="color: #997700; font-weight: bold">position</span> : positions) {
            <span style="color: #008800; font-weight: bold">const</span> <span style="color: #008800; font-weight: bold">auto</span><span style="color: #333333">&amp;</span> node <span style="color: #333333">=</span> make_pair(position.first, position.second);
            set[node_id(node, n)] <span style="color: #333333">=</span> node_id(node, n);
            <span style="color: #333333">++</span>number;

            <span style="color: #008800; font-weight: bold">for</span> (<span style="color: #008800; font-weight: bold">const</span> <span style="color: #008800; font-weight: bold">auto</span><span style="color: #333333">&amp;</span> <span style="color: #997700; font-weight: bold">d</span> : directions) {
                <span style="color: #008800; font-weight: bold">const</span> <span style="color: #008800; font-weight: bold">auto</span><span style="color: #333333">&amp;</span> neighbor <span style="color: #333333">=</span> make_pair(position.first <span style="color: #333333">+</span> d.first,
                                                 position.second <span style="color: #333333">+</span> d.second);
                <span style="color: #008800; font-weight: bold">if</span> (neighbor.first <span style="color: #333333">&gt;=</span> <span style="color: #0000DD; font-weight: bold">0</span> <span style="color: #333333">&amp;&amp;</span> neighbor.first <span style="color: #333333">&lt;</span> m <span style="color: #333333">&amp;&amp;</span>
                    neighbor.second <span style="color: #333333">&gt;=</span> <span style="color: #0000DD; font-weight: bold">0</span> <span style="color: #333333">&amp;&amp;</span> neighbor.second <span style="color: #333333">&lt;</span> n <span style="color: #333333">&amp;&amp;</span>
                    set.find(node_id(neighbor, n)) <span style="color: #333333">!=</span> set.end()) {
                    <span style="color: #008800; font-weight: bold">if</span> (find_set(node_id(node, n), <span style="color: #333333">&amp;</span>set) <span style="color: #333333">!=</span> 
                        find_set(node_id(neighbor, n), <span style="color: #333333">&amp;</span>set)) {
                        <span style="color: #888888">// Merge different islands, amortised time: O(log*k) ~= O(1)</span>
                        union_set(<span style="color: #333333">&amp;</span>set, node_id(node, n), node_id(neighbor, n));
                        <span style="color: #333333">--</span>number;
                    }
                }
            }
            numbers.emplace_back(number);
        }

        <span style="color: #008800; font-weight: bold">return</span> numbers;
    }

    <span style="color: #333399; font-weight: bold">int</span> node_id(<span style="color: #008800; font-weight: bold">const</span> pair<span style="color: #333333">&lt;</span><span style="color: #333399; font-weight: bold">int</span>, <span style="color: #333399; font-weight: bold">int</span><span style="color: #333333">&gt;&amp;</span> node, <span style="color: #008800; font-weight: bold">const</span> <span style="color: #333399; font-weight: bold">int</span> n) {
        <span style="color: #008800; font-weight: bold">return</span> node.first <span style="color: #333333">*</span> n <span style="color: #333333">+</span> node.second;
    }

    <span style="color: #333399; font-weight: bold">int</span> find_set(<span style="color: #333399; font-weight: bold">int</span> x, unordered_map<span style="color: #333333">&lt;</span><span style="color: #333399; font-weight: bold">int</span>, <span style="color: #333399; font-weight: bold">int</span><span style="color: #333333">&gt;</span> <span style="color: #333333">*</span>set) {
       <span style="color: #008800; font-weight: bold">if</span> ((<span style="color: #333333">*</span>set)[x] <span style="color: #333333">!=</span> x) {
           (<span style="color: #333333">*</span>set)[x] <span style="color: #333333">=</span> find_set((<span style="color: #333333">*</span>set)[x], set);  <span style="color: #888888">// path compression.</span>
       }
       <span style="color: #008800; font-weight: bold">return</span> (<span style="color: #333333">*</span>set)[x];
    }

    <span style="color: #333399; font-weight: bold">void</span> union_set(unordered_map<span style="color: #333333">&lt;</span><span style="color: #333399; font-weight: bold">int</span>, <span style="color: #333399; font-weight: bold">int</span><span style="color: #333333">&gt;</span> <span style="color: #333333">*</span>set, <span style="color: #008800; font-weight: bold">const</span> <span style="color: #333399; font-weight: bold">int</span> x, <span style="color: #008800; font-weight: bold">const</span> <span style="color: #333399; font-weight: bold">int</span> y) {
        <span style="color: #333399; font-weight: bold">int</span> x_root <span style="color: #333333">=</span> find_set(x, set), y_root <span style="color: #333333">=</span> find_set(y, set);
        (<span style="color: #333333">*</span>set)[min(x_root, y_root)] <span style="color: #333333">=</span> max(x_root, y_root);
    }
};


<span style="color: #888888">// Time:  O(klog*k) ~= O(k), k is the length of the positions</span>
<span style="color: #888888">// Space: O(m * n)</span>
<span style="color: #888888">// Using vector.</span>
<span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">Solution2</span> {
<span style="color: #008800; font-weight: bold">public</span><span style="color: #333333">:</span>
    <span style="color: #888888">/**</span>
<span style="color: #888888">     * @param n an integer</span>
<span style="color: #888888">     * @param m an integer</span>
<span style="color: #888888">     * @param operators an array of point</span>
<span style="color: #888888">     * @return an integer array</span>
<span style="color: #888888">     */</span>
    vector<span style="color: #333333">&lt;</span><span style="color: #333399; font-weight: bold">int</span><span style="color: #333333">&gt;</span> numIslands2(<span style="color: #333399; font-weight: bold">int</span> m, <span style="color: #333399; font-weight: bold">int</span> n, vector<span style="color: #333333">&lt;</span>pair<span style="color: #333333">&lt;</span><span style="color: #333399; font-weight: bold">int</span>, <span style="color: #333399; font-weight: bold">int</span><span style="color: #333333">&gt;&gt;&amp;</span> positions) {
        vector<span style="color: #333333">&lt;</span><span style="color: #333399; font-weight: bold">int</span><span style="color: #333333">&gt;</span> numbers;
        <span style="color: #333399; font-weight: bold">int</span> number <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">0</span>;
        <span style="color: #008800; font-weight: bold">const</span> vector<span style="color: #333333">&lt;</span>pair<span style="color: #333333">&lt;</span><span style="color: #333399; font-weight: bold">int</span>, <span style="color: #333399; font-weight: bold">int</span><span style="color: #333333">&gt;&gt;</span> directions{{<span style="color: #0000DD; font-weight: bold">0</span>, <span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span>}, {<span style="color: #0000DD; font-weight: bold">0</span>, <span style="color: #0000DD; font-weight: bold">1</span>},
                                                {<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span>, <span style="color: #0000DD; font-weight: bold">0</span>}, {<span style="color: #0000DD; font-weight: bold">1</span>, <span style="color: #0000DD; font-weight: bold">0</span>}};
        vector<span style="color: #333333">&lt;</span><span style="color: #333399; font-weight: bold">int</span><span style="color: #333333">&gt;</span> set(m <span style="color: #333333">*</span> n, <span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span>);
        <span style="color: #008800; font-weight: bold">for</span> (<span style="color: #008800; font-weight: bold">const</span> <span style="color: #008800; font-weight: bold">auto</span><span style="color: #333333">&amp;</span> <span style="color: #997700; font-weight: bold">position</span> : positions) {
            <span style="color: #008800; font-weight: bold">const</span> <span style="color: #008800; font-weight: bold">auto</span><span style="color: #333333">&amp;</span> node <span style="color: #333333">=</span> make_pair(position.first, position.second);
            set[node_id(node, n)] <span style="color: #333333">=</span> node_id(node, n);
            <span style="color: #333333">++</span>number;

            <span style="color: #008800; font-weight: bold">for</span> (<span style="color: #008800; font-weight: bold">const</span> <span style="color: #008800; font-weight: bold">auto</span><span style="color: #333333">&amp;</span> <span style="color: #997700; font-weight: bold">d</span> : directions) {
                <span style="color: #008800; font-weight: bold">const</span> <span style="color: #008800; font-weight: bold">auto</span><span style="color: #333333">&amp;</span> neighbor <span style="color: #333333">=</span> make_pair(position.first <span style="color: #333333">+</span> d.first,
                                                 position.second <span style="color: #333333">+</span> d.second);
                <span style="color: #008800; font-weight: bold">if</span> (neighbor.first <span style="color: #333333">&gt;=</span> <span style="color: #0000DD; font-weight: bold">0</span> <span style="color: #333333">&amp;&amp;</span> neighbor.first <span style="color: #333333">&lt;</span> m <span style="color: #333333">&amp;&amp;</span>
                    neighbor.second <span style="color: #333333">&gt;=</span> <span style="color: #0000DD; font-weight: bold">0</span> <span style="color: #333333">&amp;&amp;</span> neighbor.second <span style="color: #333333">&lt;</span> n <span style="color: #333333">&amp;&amp;</span>
                    set[node_id(neighbor, n)] <span style="color: #333333">!=</span> <span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span>) {
                    <span style="color: #008800; font-weight: bold">if</span> (find_set(node_id(node, n), <span style="color: #333333">&amp;</span>set) <span style="color: #333333">!=</span> 
                        find_set(node_id(neighbor, n), <span style="color: #333333">&amp;</span>set)) {
                        <span style="color: #888888">// Merge different islands, amortised time: O(log*k) ~= O(1)</span>
                        union_set(<span style="color: #333333">&amp;</span>set, node_id(node, n), node_id(neighbor, n));
                        <span style="color: #333333">--</span>number;
                    }
                }
            }
            numbers.emplace_back(number);
        }

        <span style="color: #008800; font-weight: bold">return</span> numbers;
    }

    <span style="color: #333399; font-weight: bold">int</span> node_id(<span style="color: #008800; font-weight: bold">const</span> pair<span style="color: #333333">&lt;</span><span style="color: #333399; font-weight: bold">int</span>, <span style="color: #333399; font-weight: bold">int</span><span style="color: #333333">&gt;&amp;</span> node, <span style="color: #008800; font-weight: bold">const</span> <span style="color: #333399; font-weight: bold">int</span> m) {
        <span style="color: #008800; font-weight: bold">return</span> node.first <span style="color: #333333">*</span> m <span style="color: #333333">+</span> node.second;
    }

    <span style="color: #333399; font-weight: bold">int</span> find_set(<span style="color: #333399; font-weight: bold">int</span> x, vector<span style="color: #333333">&lt;</span><span style="color: #333399; font-weight: bold">int</span><span style="color: #333333">&gt;</span> <span style="color: #333333">*</span>set) {
        <span style="color: #333399; font-weight: bold">int</span> parent <span style="color: #333333">=</span> x;
        <span style="color: #008800; font-weight: bold">while</span> ((<span style="color: #333333">*</span>set)[parent] <span style="color: #333333">!=</span> parent) {
            parent <span style="color: #333333">=</span> (<span style="color: #333333">*</span>set)[parent];
        }
        <span style="color: #008800; font-weight: bold">while</span> ((<span style="color: #333333">*</span>set)[x] <span style="color: #333333">!=</span> x) {
            <span style="color: #333399; font-weight: bold">int</span> tmp <span style="color: #333333">=</span> (<span style="color: #333333">*</span>set)[x];
            (<span style="color: #333333">*</span>set)[x] <span style="color: #333333">=</span> parent;
            x <span style="color: #333333">=</span> tmp;
        }
        <span style="color: #008800; font-weight: bold">return</span> parent;
    }

    <span style="color: #333399; font-weight: bold">void</span> union_set(vector<span style="color: #333333">&lt;</span><span style="color: #333399; font-weight: bold">int</span><span style="color: #333333">&gt;</span> <span style="color: #333333">*</span>set, <span style="color: #008800; font-weight: bold">const</span> <span style="color: #333399; font-weight: bold">int</span> x, <span style="color: #008800; font-weight: bold">const</span> <span style="color: #333399; font-weight: bold">int</span> y) {
        <span style="color: #333399; font-weight: bold">int</span> x_root <span style="color: #333333">=</span> find_set(x, set), y_root <span style="color: #333333">=</span> find_set(y, set);
        (<span style="color: #333333">*</span>set)[min(x_root, y_root)] <span style="color: #333333">=</span> max(x_root, y_root);
    }
};
</pre></div>
