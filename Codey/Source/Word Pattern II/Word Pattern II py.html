<!-- HTML generated by Yang Ye --><div style="background: #ffffff; overflow:auto;width:auto;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span></span><span style="color: #888888"># Time:  O(n * C(n - 1, c - 1)), n is length of str, c is unique count of pattern,</span>
<span style="color: #888888">#                                there are H(n - c, c - 1) = C(n - 1, c - 1) possible splits of string,</span>
<span style="color: #888888">#                                and each one costs O(n) to check if it matches the word pattern.</span>
<span style="color: #888888"># Space: O(n + c) </span>

<span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">Solution</span>(<span style="color: #007020">object</span>):
    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">wordPatternMatch</span>(<span style="color: #007020">self</span>, pattern, <span style="color: #007020">str</span>):
        <span style="color: #DD4422">&quot;&quot;&quot;</span>
<span style="color: #DD4422">        :type pattern: str</span>
<span style="color: #DD4422">        :type str: str</span>
<span style="color: #DD4422">        :rtype: bool</span>
<span style="color: #DD4422">        &quot;&quot;&quot;</span>
        w2p, p2w <span style="color: #333333">=</span> {}, {}
        <span style="color: #008800; font-weight: bold">return</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>match(pattern, <span style="color: #007020">str</span>, <span style="color: #0000DD; font-weight: bold">0</span>, <span style="color: #0000DD; font-weight: bold">0</span>, w2p, p2w)


    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">match</span>(<span style="color: #007020">self</span>, pattern, <span style="color: #007020">str</span>, i, j, w2p, p2w):
        is_match <span style="color: #333333">=</span> <span style="color: #007020">False</span>
        <span style="color: #008800; font-weight: bold">if</span> i <span style="color: #333333">==</span> <span style="color: #007020">len</span>(pattern) <span style="color: #000000; font-weight: bold">and</span> j <span style="color: #333333">==</span> <span style="color: #007020">len</span>(<span style="color: #007020">str</span>):
            is_match <span style="color: #333333">=</span> <span style="color: #007020">True</span>
        <span style="color: #008800; font-weight: bold">elif</span> i <span style="color: #333333">&lt;</span> <span style="color: #007020">len</span>(pattern) <span style="color: #000000; font-weight: bold">and</span> j <span style="color: #333333">&lt;</span> <span style="color: #007020">len</span>(<span style="color: #007020">str</span>):
            p <span style="color: #333333">=</span> pattern[i]
            <span style="color: #008800; font-weight: bold">if</span> p <span style="color: #000000; font-weight: bold">in</span> p2w:
                w <span style="color: #333333">=</span> p2w[p]
                <span style="color: #008800; font-weight: bold">if</span> w <span style="color: #333333">==</span> <span style="color: #007020">str</span>[j:j<span style="color: #333333">+</span><span style="color: #007020">len</span>(w)]:  <span style="color: #888888"># Match pattern.</span>
                    is_match <span style="color: #333333">=</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>match(pattern, <span style="color: #007020">str</span>, i <span style="color: #333333">+</span> <span style="color: #0000DD; font-weight: bold">1</span>, j <span style="color: #333333">+</span> <span style="color: #007020">len</span>(w), w2p, p2w)
                <span style="color: #888888"># Else return false.</span>
            <span style="color: #008800; font-weight: bold">else</span>:
                <span style="color: #008800; font-weight: bold">for</span> k <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">xrange</span>(j, <span style="color: #007020">len</span>(<span style="color: #007020">str</span>)):  <span style="color: #888888"># Try any possible word</span>
                    w <span style="color: #333333">=</span> <span style="color: #007020">str</span>[j:k<span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">1</span>]
                    <span style="color: #008800; font-weight: bold">if</span> w <span style="color: #000000; font-weight: bold">not</span> <span style="color: #000000; font-weight: bold">in</span> w2p:
                        <span style="color: #888888"># Build mapping. Space: O(n + c)</span>
                        w2p[w], p2w[p] <span style="color: #333333">=</span> p, w;
                        is_match <span style="color: #333333">=</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>match(pattern, <span style="color: #007020">str</span>, i <span style="color: #333333">+</span> <span style="color: #0000DD; font-weight: bold">1</span>, k <span style="color: #333333">+</span> <span style="color: #0000DD; font-weight: bold">1</span>, w2p, p2w)
                        w2p<span style="color: #333333">.</span>pop(w), p2w<span style="color: #333333">.</span>pop(p);
                    <span style="color: #008800; font-weight: bold">if</span> is_match:
                        <span style="color: #008800; font-weight: bold">break</span>
        <span style="color: #008800; font-weight: bold">return</span> is_match
</pre></div>
