<!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #008800; font-weight: bold">public</span> <span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">LFUCache</span> <span style="color: #333333">{</span>
    Node head <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">null</span><span style="color: #333333">;</span>
    <span style="color: #008800; font-weight: bold">final</span> <span style="color: #333399; font-weight: bold">int</span> capacity<span style="color: #333333">;</span>
    Map<span style="color: #333333">&lt;</span>Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">&gt;</span> valueMap<span style="color: #333333">;</span>
    Map<span style="color: #333333">&lt;</span>Integer<span style="color: #333333">,</span> Node<span style="color: #333333">&gt;</span> nodeMap<span style="color: #333333">;</span>

    <span style="color: #008800; font-weight: bold">public</span> <span style="color: #0066BB; font-weight: bold">LFUCache</span> <span style="color: #333333">(</span><span style="color: #333399; font-weight: bold">int</span> capacity<span style="color: #333333">)</span> <span style="color: #333333">{</span>
        <span style="color: #008800; font-weight: bold">this</span><span style="color: #333333">.</span><span style="color: #0000CC">capacity</span> <span style="color: #333333">=</span> capacity<span style="color: #333333">;</span>
        valueMap <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">new</span> HashMap<span style="color: #333333">&lt;&gt;(</span><span style="color: #008800; font-weight: bold">this</span><span style="color: #333333">.</span><span style="color: #0000CC">capacity</span><span style="color: #333333">,</span> <span style="color: #0000DD; font-weight: bold">1</span>f<span style="color: #333333">);</span>
        nodeMap <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">new</span> HashMap<span style="color: #333333">&lt;&gt;(</span><span style="color: #008800; font-weight: bold">this</span><span style="color: #333333">.</span><span style="color: #0000CC">capacity</span><span style="color: #333333">,</span> <span style="color: #0000DD; font-weight: bold">1</span>f<span style="color: #333333">);</span>
    <span style="color: #333333">}</span>

    <span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">int</span> <span style="color: #0066BB; font-weight: bold">get</span><span style="color: #333333">(</span><span style="color: #333399; font-weight: bold">int</span> key<span style="color: #333333">)</span> <span style="color: #333333">{</span>
        <span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>valueMap<span style="color: #333333">.</span><span style="color: #0000CC">containsKey</span><span style="color: #333333">(</span>key<span style="color: #333333">))</span> increase<span style="color: #333333">(</span>key<span style="color: #333333">,</span> valueMap<span style="color: #333333">.</span><span style="color: #0000CC">get</span><span style="color: #333333">(</span>key<span style="color: #333333">));</span>
        <span style="color: #008800; font-weight: bold">return</span> valueMap<span style="color: #333333">.</span><span style="color: #0000CC">getOrDefault</span><span style="color: #333333">(</span>key<span style="color: #333333">,</span> <span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span><span style="color: #333333">);</span>
    <span style="color: #333333">}</span>

    <span style="color: #008800; font-weight: bold">private</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">increase</span><span style="color: #333333">(</span><span style="color: #333399; font-weight: bold">int</span> key<span style="color: #333333">,</span> <span style="color: #333399; font-weight: bold">int</span> value<span style="color: #333333">)</span> <span style="color: #333333">{</span>
        Node node <span style="color: #333333">=</span> nodeMap<span style="color: #333333">.</span><span style="color: #0000CC">get</span><span style="color: #333333">(</span>key<span style="color: #333333">);</span>
        node<span style="color: #333333">.</span><span style="color: #0000CC">keys</span><span style="color: #333333">.</span><span style="color: #0000CC">remove</span><span style="color: #333333">(</span>key<span style="color: #333333">);</span>
        <span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>Objects<span style="color: #333333">.</span><span style="color: #0000CC">isNull</span><span style="color: #333333">(</span>node<span style="color: #333333">.</span><span style="color: #0000CC">next</span><span style="color: #333333">))</span> node<span style="color: #333333">.</span><span style="color: #0000CC">next</span> <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">new</span> Node<span style="color: #333333">(</span>node<span style="color: #333333">,</span> <span style="color: #008800; font-weight: bold">null</span><span style="color: #333333">,</span> <span style="color: #0000DD; font-weight: bold">1</span> <span style="color: #333333">+</span> node<span style="color: #333333">.</span><span style="color: #0000CC">count</span><span style="color: #333333">,</span> key<span style="color: #333333">);</span>
        <span style="color: #008800; font-weight: bold">else</span> <span style="color: #0066BB; font-weight: bold">if</span> <span style="color: #333333">(</span>node<span style="color: #333333">.</span><span style="color: #0000CC">next</span><span style="color: #333333">.</span><span style="color: #0000CC">count</span> <span style="color: #333333">==</span> node<span style="color: #333333">.</span><span style="color: #0000CC">count</span> <span style="color: #333333">+</span> <span style="color: #0000DD; font-weight: bold">1</span><span style="color: #333333">)</span> node<span style="color: #333333">.</span><span style="color: #0000CC">next</span><span style="color: #333333">.</span><span style="color: #0000CC">keys</span><span style="color: #333333">.</span><span style="color: #0000CC">add</span><span style="color: #333333">(</span>key<span style="color: #333333">);</span>
        <span style="color: #008800; font-weight: bold">else</span> node<span style="color: #333333">.</span><span style="color: #0000CC">next</span> <span style="color: #333333">=</span> node<span style="color: #333333">.</span><span style="color: #0000CC">next</span><span style="color: #333333">.</span><span style="color: #0000CC">prev</span> <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">new</span> Node<span style="color: #333333">(</span>node<span style="color: #333333">,</span> node<span style="color: #333333">.</span><span style="color: #0000CC">next</span><span style="color: #333333">,</span> node<span style="color: #333333">.</span><span style="color: #0000CC">count</span> <span style="color: #333333">+</span> <span style="color: #0000DD; font-weight: bold">1</span><span style="color: #333333">,</span> key<span style="color: #333333">);</span>
        nodeMap<span style="color: #333333">.</span><span style="color: #0000CC">put</span><span style="color: #333333">(</span>key<span style="color: #333333">,</span> node<span style="color: #333333">.</span><span style="color: #0000CC">next</span><span style="color: #333333">);</span>
        valueMap<span style="color: #333333">.</span><span style="color: #0000CC">put</span><span style="color: #333333">(</span>key<span style="color: #333333">,</span> value<span style="color: #333333">);</span>
        <span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>node<span style="color: #333333">.</span><span style="color: #0000CC">keys</span><span style="color: #333333">.</span><span style="color: #0000CC">isEmpty</span><span style="color: #333333">())</span> remove<span style="color: #333333">(</span>node<span style="color: #333333">);</span>
    <span style="color: #333333">}</span>

    <span style="color: #008800; font-weight: bold">private</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">remove</span><span style="color: #333333">(</span>Node node<span style="color: #333333">)</span> <span style="color: #333333">{</span>
        <span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>head <span style="color: #333333">==</span> node<span style="color: #333333">)</span> head <span style="color: #333333">=</span> node<span style="color: #333333">.</span><span style="color: #0000CC">next</span><span style="color: #333333">;</span>
        <span style="color: #008800; font-weight: bold">else</span> node<span style="color: #333333">.</span><span style="color: #0000CC">prev</span><span style="color: #333333">.</span><span style="color: #0000CC">next</span> <span style="color: #333333">=</span> node<span style="color: #333333">.</span><span style="color: #0000CC">next</span><span style="color: #333333">;</span>
        <span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>Objects<span style="color: #333333">.</span><span style="color: #0000CC">nonNull</span><span style="color: #333333">(</span>node<span style="color: #333333">.</span><span style="color: #0000CC">next</span><span style="color: #333333">))</span> node<span style="color: #333333">.</span><span style="color: #0000CC">next</span><span style="color: #333333">.</span><span style="color: #0000CC">prev</span> <span style="color: #333333">=</span> node<span style="color: #333333">.</span><span style="color: #0000CC">prev</span><span style="color: #333333">;</span>
    <span style="color: #333333">}</span>

    <span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">set</span><span style="color: #333333">(</span><span style="color: #333399; font-weight: bold">int</span> key<span style="color: #333333">,</span> <span style="color: #333399; font-weight: bold">int</span> value<span style="color: #333333">)</span> <span style="color: #333333">{</span>
        <span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span><span style="color: #0000DD; font-weight: bold">0</span> <span style="color: #333333">==</span> <span style="color: #008800; font-weight: bold">this</span><span style="color: #333333">.</span><span style="color: #0000CC">capacity</span><span style="color: #333333">)</span> <span style="color: #008800; font-weight: bold">return</span><span style="color: #333333">;</span>
        <span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>valueMap<span style="color: #333333">.</span><span style="color: #0000CC">containsKey</span><span style="color: #333333">(</span>key<span style="color: #333333">))</span> <span style="color: #333333">{</span>
            increase<span style="color: #333333">(</span>key<span style="color: #333333">,</span> value<span style="color: #333333">);</span>
        <span style="color: #333333">}</span> <span style="color: #008800; font-weight: bold">else</span> <span style="color: #333333">{</span>
            <span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>valueMap<span style="color: #333333">.</span><span style="color: #0000CC">size</span><span style="color: #333333">()</span> <span style="color: #333333">==</span> <span style="color: #008800; font-weight: bold">this</span><span style="color: #333333">.</span><span style="color: #0000CC">capacity</span><span style="color: #333333">)</span> remove<span style="color: #333333">();</span>
            valueMap<span style="color: #333333">.</span><span style="color: #0000CC">put</span><span style="color: #333333">(</span>key<span style="color: #333333">,</span> value<span style="color: #333333">);</span>
            add<span style="color: #333333">(</span>key<span style="color: #333333">);</span>
        <span style="color: #333333">}</span>
    <span style="color: #333333">}</span>

    <span style="color: #008800; font-weight: bold">private</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">add</span><span style="color: #333333">(</span><span style="color: #333399; font-weight: bold">int</span> key<span style="color: #333333">)</span> <span style="color: #333333">{</span>
        <span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>Objects<span style="color: #333333">.</span><span style="color: #0000CC">isNull</span><span style="color: #333333">(</span>head<span style="color: #333333">))</span> head <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">new</span> Node<span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">null</span><span style="color: #333333">,</span> <span style="color: #008800; font-weight: bold">null</span><span style="color: #333333">,</span> <span style="color: #0000DD; font-weight: bold">1</span><span style="color: #333333">,</span> key<span style="color: #333333">);</span>
        <span style="color: #008800; font-weight: bold">else</span> <span style="color: #0066BB; font-weight: bold">if</span> <span style="color: #333333">(</span>head<span style="color: #333333">.</span><span style="color: #0000CC">count</span> <span style="color: #333333">==</span> <span style="color: #0000DD; font-weight: bold">1</span><span style="color: #333333">)</span> head<span style="color: #333333">.</span><span style="color: #0000CC">keys</span><span style="color: #333333">.</span><span style="color: #0000CC">add</span><span style="color: #333333">(</span>key<span style="color: #333333">);</span>
        <span style="color: #008800; font-weight: bold">else</span> head <span style="color: #333333">=</span> head<span style="color: #333333">.</span><span style="color: #0000CC">prev</span> <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">new</span> Node<span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">null</span><span style="color: #333333">,</span> head<span style="color: #333333">,</span> <span style="color: #0000DD; font-weight: bold">1</span><span style="color: #333333">,</span> key<span style="color: #333333">);</span>
        nodeMap<span style="color: #333333">.</span><span style="color: #0000CC">put</span><span style="color: #333333">(</span>key<span style="color: #333333">,</span> head<span style="color: #333333">);</span>
    <span style="color: #333333">}</span>

    <span style="color: #008800; font-weight: bold">private</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">remove</span><span style="color: #333333">()</span> <span style="color: #333333">{</span>
        <span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>Objects<span style="color: #333333">.</span><span style="color: #0000CC">isNull</span><span style="color: #333333">(</span>head<span style="color: #333333">))</span> <span style="color: #008800; font-weight: bold">return</span><span style="color: #333333">;</span>
        <span style="color: #333399; font-weight: bold">int</span> oldest <span style="color: #333333">=</span> head<span style="color: #333333">.</span><span style="color: #0000CC">keys</span><span style="color: #333333">.</span><span style="color: #0000CC">iterator</span><span style="color: #333333">().</span><span style="color: #0000CC">next</span><span style="color: #333333">();</span>
        head<span style="color: #333333">.</span><span style="color: #0000CC">keys</span><span style="color: #333333">.</span><span style="color: #0000CC">remove</span><span style="color: #333333">(</span>oldest<span style="color: #333333">);</span>
        <span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>head<span style="color: #333333">.</span><span style="color: #0000CC">keys</span><span style="color: #333333">.</span><span style="color: #0000CC">isEmpty</span><span style="color: #333333">())</span> remove<span style="color: #333333">(</span>head<span style="color: #333333">);</span>
        nodeMap<span style="color: #333333">.</span><span style="color: #0000CC">remove</span><span style="color: #333333">(</span>oldest<span style="color: #333333">);</span>
        valueMap<span style="color: #333333">.</span><span style="color: #0000CC">remove</span><span style="color: #333333">(</span>oldest<span style="color: #333333">);</span>
    <span style="color: #333333">}</span>

    <span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">Node</span> <span style="color: #333333">{</span>
        <span style="color: #008800; font-weight: bold">public</span> Node prev<span style="color: #333333">,</span> next<span style="color: #333333">;</span>
        <span style="color: #008800; font-weight: bold">public</span> <span style="color: #008800; font-weight: bold">final</span> <span style="color: #333399; font-weight: bold">int</span> count<span style="color: #333333">;</span>
        <span style="color: #008800; font-weight: bold">public</span> LinkedHashSet<span style="color: #333333">&lt;</span>Integer<span style="color: #333333">&gt;</span> keys <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">new</span> LinkedHashSet<span style="color: #333333">&lt;&gt;();</span>

        <span style="color: #008800; font-weight: bold">public</span> <span style="color: #0066BB; font-weight: bold">Node</span><span style="color: #333333">(</span>Node prev<span style="color: #333333">,</span> Node next<span style="color: #333333">,</span> <span style="color: #333399; font-weight: bold">int</span> count<span style="color: #333333">,</span> <span style="color: #333399; font-weight: bold">int</span> key<span style="color: #333333">)</span> <span style="color: #333333">{</span>
            <span style="color: #008800; font-weight: bold">this</span><span style="color: #333333">.</span><span style="color: #0000CC">prev</span> <span style="color: #333333">=</span> prev<span style="color: #333333">;</span>
            <span style="color: #008800; font-weight: bold">this</span><span style="color: #333333">.</span><span style="color: #0000CC">next</span> <span style="color: #333333">=</span> next<span style="color: #333333">;</span>
            <span style="color: #008800; font-weight: bold">this</span><span style="color: #333333">.</span><span style="color: #0000CC">count</span> <span style="color: #333333">=</span> count<span style="color: #333333">;</span>
            keys<span style="color: #333333">.</span><span style="color: #0000CC">add</span><span style="color: #333333">(</span>key<span style="color: #333333">);</span>
        <span style="color: #333333">}</span>
    <span style="color: #333333">}</span>
<span style="color: #333333">}</span>

<span style="color: #888888">/**</span>
<span style="color: #888888"> * Your LFUCache object will be instantiated and called as such:</span>
<span style="color: #888888"> * LFUCache obj = new LFUCache(capacity);</span>
<span style="color: #888888"> * int param_1 = obj.get(key);</span>
<span style="color: #888888"> * obj.set(key,value);</span>
<span style="color: #888888"> */</span>
</pre></div>
