<!-- HTML generated by Yang Ye --><div style="background: #ffffff; overflow:auto;width:auto;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span></span><span style="color: #888888"># Time:  O(1), per operation.</span>
<span style="color: #888888"># Space: O(k), k is the capacity of cache.</span>

<span style="color: #888888"># Design and implement a data structure for Least Recently Used (LRU) cache. </span>
<span style="color: #888888"># It should support the following operations: get and set.</span>
<span style="color: #888888"># </span>
<span style="color: #888888"># get(key) - Get the value (will always be positive) of the key if the key exists in the cache, otherwise return -1.</span>
<span style="color: #888888"># </span>
<span style="color: #888888"># set(key, value) - Set or insert the value if the key is not already present. </span>
<span style="color: #888888"># When the cache reached its capacity, it should invalidate the least recently used item before inserting a new item.</span>

<span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">ListNode</span>:
    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">__init__</span>(<span style="color: #007020">self</span>, key, val):
        <span style="color: #007020">self</span><span style="color: #333333">.</span>val <span style="color: #333333">=</span> val
        <span style="color: #007020">self</span><span style="color: #333333">.</span>key <span style="color: #333333">=</span> key
        <span style="color: #007020">self</span><span style="color: #333333">.</span>next <span style="color: #333333">=</span> <span style="color: #007020">None</span>
        <span style="color: #007020">self</span><span style="color: #333333">.</span>prev <span style="color: #333333">=</span> <span style="color: #007020">None</span>

<span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">LinkedList</span>:
    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">__init__</span>(<span style="color: #007020">self</span>):
        <span style="color: #007020">self</span><span style="color: #333333">.</span>head <span style="color: #333333">=</span> <span style="color: #007020">None</span>
        <span style="color: #007020">self</span><span style="color: #333333">.</span>tail <span style="color: #333333">=</span> <span style="color: #007020">None</span>
    
    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">insert</span>(<span style="color: #007020">self</span>, node):
        <span style="color: #008800; font-weight: bold">if</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>head <span style="color: #000000; font-weight: bold">is</span> <span style="color: #007020">None</span>:
            <span style="color: #007020">self</span><span style="color: #333333">.</span>head <span style="color: #333333">=</span> node
        <span style="color: #008800; font-weight: bold">else</span>:
            <span style="color: #007020">self</span><span style="color: #333333">.</span>tail<span style="color: #333333">.</span>next <span style="color: #333333">=</span> node
            node<span style="color: #333333">.</span>prev <span style="color: #333333">=</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>tail
        <span style="color: #007020">self</span><span style="color: #333333">.</span>tail <span style="color: #333333">=</span> node
            
    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">delete</span>(<span style="color: #007020">self</span>, node):
        <span style="color: #008800; font-weight: bold">if</span> node<span style="color: #333333">.</span>prev:
            node<span style="color: #333333">.</span>prev<span style="color: #333333">.</span>next <span style="color: #333333">=</span> node<span style="color: #333333">.</span>next
        <span style="color: #008800; font-weight: bold">else</span>:
            <span style="color: #007020">self</span><span style="color: #333333">.</span>head <span style="color: #333333">=</span> node<span style="color: #333333">.</span>next
        <span style="color: #008800; font-weight: bold">if</span> node<span style="color: #333333">.</span>next:
            node<span style="color: #333333">.</span>next<span style="color: #333333">.</span>prev <span style="color: #333333">=</span> node<span style="color: #333333">.</span>prev
        <span style="color: #008800; font-weight: bold">else</span>:
            <span style="color: #007020">self</span><span style="color: #333333">.</span>tail <span style="color: #333333">=</span> node<span style="color: #333333">.</span>prev
        <span style="color: #008800; font-weight: bold">del</span> node

<span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">LRUCache</span>:

    <span style="color: #888888"># @param capacity, an integer</span>
    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">__init__</span>(<span style="color: #007020">self</span>, capacity):
        <span style="color: #007020">self</span><span style="color: #333333">.</span>list <span style="color: #333333">=</span> LinkedList()
        <span style="color: #007020">self</span><span style="color: #333333">.</span>dict <span style="color: #333333">=</span> {}
        <span style="color: #007020">self</span><span style="color: #333333">.</span>capacity <span style="color: #333333">=</span> capacity
        
    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">_insert</span>(<span style="color: #007020">self</span>, key, val):
        node <span style="color: #333333">=</span> ListNode(key, val)
        <span style="color: #007020">self</span><span style="color: #333333">.</span>list<span style="color: #333333">.</span>insert(node)
        <span style="color: #007020">self</span><span style="color: #333333">.</span>dict[key] <span style="color: #333333">=</span> node
        

    <span style="color: #888888"># @return an integer</span>
    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">get</span>(<span style="color: #007020">self</span>, key):
        <span style="color: #008800; font-weight: bold">if</span> key <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>dict:
            val <span style="color: #333333">=</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>dict[key]<span style="color: #333333">.</span>val
            <span style="color: #007020">self</span><span style="color: #333333">.</span>list<span style="color: #333333">.</span>delete(<span style="color: #007020">self</span><span style="color: #333333">.</span>dict[key])
            <span style="color: #007020">self</span><span style="color: #333333">.</span>_insert(key, val)
            <span style="color: #008800; font-weight: bold">return</span> val
        <span style="color: #008800; font-weight: bold">return</span> <span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span>
        

    <span style="color: #888888"># @param key, an integer</span>
    <span style="color: #888888"># @param value, an integer</span>
    <span style="color: #888888"># @return nothing</span>
    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">set</span>(<span style="color: #007020">self</span>, key, val):
        <span style="color: #008800; font-weight: bold">if</span> key <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>dict:
            <span style="color: #007020">self</span><span style="color: #333333">.</span>list<span style="color: #333333">.</span>delete(<span style="color: #007020">self</span><span style="color: #333333">.</span>dict[key])
        <span style="color: #008800; font-weight: bold">elif</span> <span style="color: #007020">len</span>(<span style="color: #007020">self</span><span style="color: #333333">.</span>dict) <span style="color: #333333">==</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>capacity:
            <span style="color: #008800; font-weight: bold">del</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>dict[<span style="color: #007020">self</span><span style="color: #333333">.</span>list<span style="color: #333333">.</span>head<span style="color: #333333">.</span>key]
            <span style="color: #007020">self</span><span style="color: #333333">.</span>list<span style="color: #333333">.</span>delete(<span style="color: #007020">self</span><span style="color: #333333">.</span>list<span style="color: #333333">.</span>head)
        <span style="color: #007020">self</span><span style="color: #333333">.</span>_insert(key, val)
 
 
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">collections</span>
<span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">LRUCache2</span>:
    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">__init__</span>(<span style="color: #007020">self</span>, capacity):
        <span style="color: #007020">self</span><span style="color: #333333">.</span>cache <span style="color: #333333">=</span> collections<span style="color: #333333">.</span>OrderedDict()
        <span style="color: #007020">self</span><span style="color: #333333">.</span>capacity <span style="color: #333333">=</span> capacity

    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">get</span>(<span style="color: #007020">self</span>, key):
        <span style="color: #008800; font-weight: bold">if</span> key <span style="color: #000000; font-weight: bold">not</span> <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>cache:
            <span style="color: #008800; font-weight: bold">return</span> <span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span>
        val <span style="color: #333333">=</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>cache[key]
        <span style="color: #008800; font-weight: bold">del</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>cache[key]
        <span style="color: #007020">self</span><span style="color: #333333">.</span>cache[key] <span style="color: #333333">=</span> val
        <span style="color: #008800; font-weight: bold">return</span> val

    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">set</span>(<span style="color: #007020">self</span>, key, value):
        <span style="color: #008800; font-weight: bold">if</span> key <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>cache:
            <span style="color: #008800; font-weight: bold">del</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>cache[key]
        <span style="color: #008800; font-weight: bold">elif</span> <span style="color: #007020">len</span>(<span style="color: #007020">self</span><span style="color: #333333">.</span>cache) <span style="color: #333333">==</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>capacity:
            <span style="color: #007020">self</span><span style="color: #333333">.</span>cache<span style="color: #333333">.</span>popitem(last<span style="color: #333333">=</span><span style="color: #007020">False</span>)
        <span style="color: #007020">self</span><span style="color: #333333">.</span>cache[key] <span style="color: #333333">=</span> value   
        
<span style="color: #008800; font-weight: bold">if</span> __name__ <span style="color: #333333">==</span> <span style="background-color: #fff0f0">&quot;__main__&quot;</span>:
    cache <span style="color: #333333">=</span> LRUCache(<span style="color: #0000DD; font-weight: bold">3</span>)
    cache<span style="color: #333333">.</span>set(<span style="color: #0000DD; font-weight: bold">1</span>, <span style="color: #0000DD; font-weight: bold">1</span>)
    cache<span style="color: #333333">.</span>set(<span style="color: #0000DD; font-weight: bold">2</span>, <span style="color: #0000DD; font-weight: bold">2</span>)
    cache<span style="color: #333333">.</span>set(<span style="color: #0000DD; font-weight: bold">3</span>, <span style="color: #0000DD; font-weight: bold">3</span>)
    <span style="color: #008800; font-weight: bold">print</span> cache<span style="color: #333333">.</span>get(<span style="color: #0000DD; font-weight: bold">1</span>)
    cache<span style="color: #333333">.</span>set(<span style="color: #0000DD; font-weight: bold">4</span>, <span style="color: #0000DD; font-weight: bold">4</span>)
    <span style="color: #008800; font-weight: bold">print</span> cache<span style="color: #333333">.</span>get(<span style="color: #0000DD; font-weight: bold">2</span>)
    
</pre></div>
