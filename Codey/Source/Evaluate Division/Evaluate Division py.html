<!-- HTML generated by Yang Ye --><div style="background: #ffffff; overflow:auto;width:auto;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span></span><span style="color: #888888"># Time:  O(e + q * |V|!), |V| is the number of variables</span>
<span style="color: #888888"># Space: O(e)</span>

<span style="color: #888888"># Equations are given in the format A / B = k,</span>
<span style="color: #888888"># where A and B are variables represented as strings,</span>
<span style="color: #888888"># and k is a real number (floating point number).</span>
<span style="color: #888888"># Given some queries, return the answers.</span>
<span style="color: #888888"># If the answer does not exist, return -1.0.</span>
<span style="color: #888888">#</span>
<span style="color: #888888"># Example:</span>
<span style="color: #888888"># Given a / b = 2.0, b / c = 3.0. </span>
<span style="color: #888888"># queries are: a / c = ?, b / a = ?, a / e = ?, a / a = ?, x / x = ? . </span>
<span style="color: #888888"># return [6.0, 0.5, -1.0, 1.0, -1.0 ].</span>
<span style="color: #888888">#</span>
<span style="color: #888888"># The input is:</span>
<span style="color: #888888"># vector&lt;pair&lt;string, string&gt;&gt; euqations, vector&lt;double&gt;&amp; values, vector&lt;pair&lt;string, string&gt;&gt; query .</span>
<span style="color: #888888">#</span>
<span style="color: #888888"># where equations.size() == values.size(),the values are positive.</span>
<span style="color: #888888"># this represents the equations.return vector&lt;double&gt;. . </span>
<span style="color: #888888"># The example above: equations = [ [&quot;a&quot;, &quot;b&quot;], [&quot;b&quot;, &quot;c&quot;] ].</span>
<span style="color: #888888"># values = [2.0, 3.0]. queries = [ [&quot;a&quot;, &quot;c&quot;], [&quot;b&quot;, &quot;a&quot;], [&quot;a&quot;, &quot;e&quot;], [&quot;a&quot;, &quot;a&quot;], [&quot;x&quot;, &quot;x&quot;] ].</span>
<span style="color: #888888">#</span>
<span style="color: #888888"># The input is always valid. You may assume that</span>
<span style="color: #888888"># evaluating the queries will result in no division by zero and there is no contradiction.</span>

<span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">Solution</span>(<span style="color: #007020">object</span>):
    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">calcEquation</span>(<span style="color: #007020">self</span>, equations, values, query):
        <span style="color: #DD4422">&quot;&quot;&quot;</span>
<span style="color: #DD4422">        :type equations: List[List[str]]</span>
<span style="color: #DD4422">        :type values: List[float]</span>
<span style="color: #DD4422">        :type query: List[List[str]]</span>
<span style="color: #DD4422">        :rtype: List[float]</span>
<span style="color: #DD4422">        &quot;&quot;&quot;</span>
        <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">check</span>(up, down, lookup, visited):
            <span style="color: #008800; font-weight: bold">if</span> up <span style="color: #000000; font-weight: bold">in</span> lookup <span style="color: #000000; font-weight: bold">and</span> down <span style="color: #000000; font-weight: bold">in</span> lookup[up]:
                <span style="color: #008800; font-weight: bold">return</span> (<span style="color: #007020">True</span>, lookup[up][down])
            <span style="color: #008800; font-weight: bold">for</span> k, v <span style="color: #000000; font-weight: bold">in</span> lookup[up]<span style="color: #333333">.</span>iteritems():
                <span style="color: #008800; font-weight: bold">if</span> k <span style="color: #000000; font-weight: bold">not</span> <span style="color: #000000; font-weight: bold">in</span> visited:
                    visited<span style="color: #333333">.</span>add(k)
                    tmp <span style="color: #333333">=</span> check(k, down, lookup, visited)
                    <span style="color: #008800; font-weight: bold">if</span> tmp[<span style="color: #0000DD; font-weight: bold">0</span>]:
                        <span style="color: #008800; font-weight: bold">return</span> (<span style="color: #007020">True</span>, v <span style="color: #333333">*</span> tmp[<span style="color: #0000DD; font-weight: bold">1</span>])
            <span style="color: #008800; font-weight: bold">return</span> (<span style="color: #007020">False</span>, <span style="color: #0000DD; font-weight: bold">0</span>)

        lookup <span style="color: #333333">=</span> collections<span style="color: #333333">.</span>defaultdict(<span style="color: #007020">dict</span>)
        <span style="color: #008800; font-weight: bold">for</span> i, e <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">enumerate</span>(equations):
            lookup[e[<span style="color: #0000DD; font-weight: bold">0</span>]][e[<span style="color: #0000DD; font-weight: bold">1</span>]] <span style="color: #333333">=</span> values[i]
            <span style="color: #008800; font-weight: bold">if</span> values[i]:
                lookup[e[<span style="color: #0000DD; font-weight: bold">1</span>]][e[<span style="color: #0000DD; font-weight: bold">0</span>]] <span style="color: #333333">=</span> <span style="color: #6600EE; font-weight: bold">1.0</span> <span style="color: #333333">/</span> values[i]

        result <span style="color: #333333">=</span> []
        <span style="color: #008800; font-weight: bold">for</span> q <span style="color: #000000; font-weight: bold">in</span> query:
            visited <span style="color: #333333">=</span> <span style="color: #007020">set</span>()
            tmp <span style="color: #333333">=</span> check(q[<span style="color: #0000DD; font-weight: bold">0</span>], q[<span style="color: #0000DD; font-weight: bold">1</span>], lookup, visited)
            result<span style="color: #333333">.</span>append(tmp[<span style="color: #0000DD; font-weight: bold">1</span>] <span style="color: #008800; font-weight: bold">if</span> tmp[<span style="color: #0000DD; font-weight: bold">0</span>] <span style="color: #008800; font-weight: bold">else</span> <span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span>)
        <span style="color: #008800; font-weight: bold">return</span> result
</pre></div>
