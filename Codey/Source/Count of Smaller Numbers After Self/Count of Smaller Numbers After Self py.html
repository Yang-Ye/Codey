<!-- HTML generated by Yang Ye --><div style="background: #ffffff; overflow:auto;width:auto;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span></span><span style="color: #888888"># Time:  O(nlogn)</span>
<span style="color: #888888"># Space: O(n)</span>

<span style="color: #888888"># You are given an integer array nums and you have to </span>
<span style="color: #888888"># return a new counts array. The counts array has the </span>
<span style="color: #888888"># property where counts[i] is the number of smaller </span>
<span style="color: #888888"># elements to the right of nums[i].</span>
<span style="color: #888888">#</span>
<span style="color: #888888"># Example:</span>
<span style="color: #888888">#</span>
<span style="color: #888888"># Given nums = [5, 2, 6, 1]</span>
<span style="color: #888888">#</span>
<span style="color: #888888"># To the right of 5 there are 2 smaller elements (2 and 1).</span>
<span style="color: #888888"># To the right of 2 there is only 1 smaller element (1).</span>
<span style="color: #888888"># To the right of 6 there is 1 smaller element (1).</span>
<span style="color: #888888"># To the right of 1 there is 0 smaller element.</span>
<span style="color: #888888"># Return the array [2, 1, 1, 0].</span>

<span style="color: #888888"># Divide and Conquer solution.</span>
<span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">Solution</span>(<span style="color: #007020">object</span>):
    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">countSmaller</span>(<span style="color: #007020">self</span>, nums):
        <span style="color: #DD4422">&quot;&quot;&quot;</span>
<span style="color: #DD4422">        :type nums: List[int]</span>
<span style="color: #DD4422">        :rtype: List[int]</span>
<span style="color: #DD4422">        &quot;&quot;&quot;</span>
        <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">countAndMergeSort</span>(num_idxs, start, end, counts):
            <span style="color: #008800; font-weight: bold">if</span> end <span style="color: #333333">-</span> start <span style="color: #333333">&lt;=</span> <span style="color: #0000DD; font-weight: bold">0</span>:  <span style="color: #888888"># The size of range [start, end] less than 2 is always with count 0.</span>
                <span style="color: #008800; font-weight: bold">return</span> <span style="color: #0000DD; font-weight: bold">0</span>

            mid <span style="color: #333333">=</span> start <span style="color: #333333">+</span> (end <span style="color: #333333">-</span> start) <span style="color: #333333">/</span> <span style="color: #0000DD; font-weight: bold">2</span>
            countAndMergeSort(num_idxs, start, mid, counts)
            countAndMergeSort(num_idxs, mid <span style="color: #333333">+</span> <span style="color: #0000DD; font-weight: bold">1</span>, end, counts)
            r <span style="color: #333333">=</span> mid <span style="color: #333333">+</span> <span style="color: #0000DD; font-weight: bold">1</span>
            tmp <span style="color: #333333">=</span> []
            <span style="color: #008800; font-weight: bold">for</span> i <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">xrange</span>(start, mid <span style="color: #333333">+</span> <span style="color: #0000DD; font-weight: bold">1</span>):
                <span style="color: #888888"># Merge the two sorted arrays into tmp.</span>
                <span style="color: #008800; font-weight: bold">while</span> r <span style="color: #333333">&lt;=</span> end <span style="color: #000000; font-weight: bold">and</span> num_idxs[r][<span style="color: #0000DD; font-weight: bold">0</span>] <span style="color: #333333">&lt;</span> num_idxs[i][<span style="color: #0000DD; font-weight: bold">0</span>]:
                    tmp<span style="color: #333333">.</span>append(num_idxs[r])
                    r <span style="color: #333333">+=</span> <span style="color: #0000DD; font-weight: bold">1</span>
                tmp<span style="color: #333333">.</span>append(num_idxs[i])
                counts[num_idxs[i][<span style="color: #0000DD; font-weight: bold">1</span>]] <span style="color: #333333">+=</span> r <span style="color: #333333">-</span> (mid <span style="color: #333333">+</span> <span style="color: #0000DD; font-weight: bold">1</span>)

            <span style="color: #888888"># Copy tmp back to num_idxs</span>
            num_idxs[start:start<span style="color: #333333">+</span><span style="color: #007020">len</span>(tmp)] <span style="color: #333333">=</span> tmp

        num_idxs <span style="color: #333333">=</span> []
        counts <span style="color: #333333">=</span> [<span style="color: #0000DD; font-weight: bold">0</span>] <span style="color: #333333">*</span> <span style="color: #007020">len</span>(nums)
        <span style="color: #008800; font-weight: bold">for</span> i, num <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">enumerate</span>(nums):
            num_idxs<span style="color: #333333">.</span>append((num, i))
        countAndMergeSort(num_idxs, <span style="color: #0000DD; font-weight: bold">0</span>, <span style="color: #007020">len</span>(num_idxs) <span style="color: #333333">-</span> <span style="color: #0000DD; font-weight: bold">1</span>, counts)
        <span style="color: #008800; font-weight: bold">return</span> counts

<span style="color: #888888"># Time:  O(nlogn)</span>
<span style="color: #888888"># Space: O(n)</span>
<span style="color: #888888"># BIT solution.</span>
<span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">Solution2</span>(<span style="color: #007020">object</span>):
    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">countSmaller</span>(<span style="color: #007020">self</span>, nums):
        <span style="color: #DD4422">&quot;&quot;&quot;</span>
<span style="color: #DD4422">        :type nums: List[int]</span>
<span style="color: #DD4422">        :rtype: List[int]</span>
<span style="color: #DD4422">        &quot;&quot;&quot;</span>
        <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">binarySearch</span>(A, target, compare):
            start, end <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">0</span>, <span style="color: #007020">len</span>(A) <span style="color: #333333">-</span> <span style="color: #0000DD; font-weight: bold">1</span>
            <span style="color: #008800; font-weight: bold">while</span> start <span style="color: #333333">&lt;=</span> end:
                mid <span style="color: #333333">=</span> start <span style="color: #333333">+</span> (end <span style="color: #333333">-</span> start) <span style="color: #333333">/</span> <span style="color: #0000DD; font-weight: bold">2</span>
                <span style="color: #008800; font-weight: bold">if</span> compare(target, A[mid]):
                    end <span style="color: #333333">=</span> mid <span style="color: #333333">-</span> <span style="color: #0000DD; font-weight: bold">1</span>
                <span style="color: #008800; font-weight: bold">else</span>:
                    start <span style="color: #333333">=</span> mid <span style="color: #333333">+</span> <span style="color: #0000DD; font-weight: bold">1</span>
            <span style="color: #008800; font-weight: bold">return</span> start

        <span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">BIT</span>(<span style="color: #007020">object</span>):
            <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">__init__</span>(<span style="color: #007020">self</span>, n):
                <span style="color: #007020">self</span><span style="color: #333333">.</span>__bit <span style="color: #333333">=</span> [<span style="color: #0000DD; font-weight: bold">0</span>] <span style="color: #333333">*</span> n

            <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">add</span>(<span style="color: #007020">self</span>, i, val):
                <span style="color: #008800; font-weight: bold">while</span> i <span style="color: #333333">&lt;</span> <span style="color: #007020">len</span>(<span style="color: #007020">self</span><span style="color: #333333">.</span>__bit):
                    <span style="color: #007020">self</span><span style="color: #333333">.</span>__bit[i] <span style="color: #333333">+=</span> val
                    i <span style="color: #333333">+=</span> (i <span style="color: #333333">&amp;</span> <span style="color: #333333">-</span>i)
    
            <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">query</span>(<span style="color: #007020">self</span>, i):
                ret <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">0</span>
                <span style="color: #008800; font-weight: bold">while</span> i <span style="color: #333333">&gt;</span> <span style="color: #0000DD; font-weight: bold">0</span>:
                    ret <span style="color: #333333">+=</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>__bit[i]
                    i <span style="color: #333333">-=</span> (i <span style="color: #333333">&amp;</span> <span style="color: #333333">-</span>i)
                <span style="color: #008800; font-weight: bold">return</span> ret

        <span style="color: #888888"># Get the place (position in the ascending order) of each number.</span>
        sorted_nums, places <span style="color: #333333">=</span> <span style="color: #007020">sorted</span>(nums), [<span style="color: #0000DD; font-weight: bold">0</span>] <span style="color: #333333">*</span> <span style="color: #007020">len</span>(nums)
        <span style="color: #008800; font-weight: bold">for</span> i, num <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">enumerate</span>(nums):
            places[i] <span style="color: #333333">=</span> binarySearch(sorted_nums, num, <span style="color: #008800; font-weight: bold">lambda</span> x, y: x <span style="color: #333333">&lt;=</span> y)

        <span style="color: #888888"># Count the smaller elements after the number.</span>
        ans, bit<span style="color: #333333">=</span> [<span style="color: #0000DD; font-weight: bold">0</span>] <span style="color: #333333">*</span> <span style="color: #007020">len</span>(nums), BIT(<span style="color: #007020">len</span>(nums) <span style="color: #333333">+</span> <span style="color: #0000DD; font-weight: bold">1</span>)
        <span style="color: #008800; font-weight: bold">for</span> i <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">reversed</span>(<span style="color: #007020">xrange</span>(<span style="color: #007020">len</span>(nums))):
            ans[i] <span style="color: #333333">=</span> bit<span style="color: #333333">.</span>query(places[i])
            bit<span style="color: #333333">.</span>add(places[i] <span style="color: #333333">+</span> <span style="color: #0000DD; font-weight: bold">1</span>, <span style="color: #0000DD; font-weight: bold">1</span>)
        <span style="color: #008800; font-weight: bold">return</span> ans

<span style="color: #888888"># Time:  O(nlogn)</span>
<span style="color: #888888"># Space: O(n)</span>
<span style="color: #888888"># BST solution.</span>
<span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">Solution3</span>(<span style="color: #007020">object</span>):
    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">countSmaller</span>(<span style="color: #007020">self</span>, nums):
        <span style="color: #DD4422">&quot;&quot;&quot;</span>
<span style="color: #DD4422">        :type nums: List[int]</span>
<span style="color: #DD4422">        :rtype: List[int]</span>
<span style="color: #DD4422">        &quot;&quot;&quot;</span>
        res <span style="color: #333333">=</span> [<span style="color: #0000DD; font-weight: bold">0</span>] <span style="color: #333333">*</span> <span style="color: #007020">len</span>(nums)
        bst <span style="color: #333333">=</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>BST()
        <span style="color: #888888"># Insert into BST and get left count.</span>
        <span style="color: #008800; font-weight: bold">for</span> i <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">reversed</span>(<span style="color: #007020">xrange</span>(<span style="color: #007020">len</span>(nums))):
            bst<span style="color: #333333">.</span>insertNode(nums[i])
            res[i] <span style="color: #333333">=</span> bst<span style="color: #333333">.</span>query(nums[i])

        <span style="color: #008800; font-weight: bold">return</span> res
    
    <span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">BST</span>(<span style="color: #007020">object</span>):
        <span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">BSTreeNode</span>(<span style="color: #007020">object</span>):
            <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">__init__</span>(<span style="color: #007020">self</span>, val):
                <span style="color: #007020">self</span><span style="color: #333333">.</span>val <span style="color: #333333">=</span> val
                <span style="color: #007020">self</span><span style="color: #333333">.</span>count <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">0</span>
                <span style="color: #007020">self</span><span style="color: #333333">.</span>left <span style="color: #333333">=</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>right <span style="color: #333333">=</span> <span style="color: #007020">None</span>
    
        <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">__init__</span>(<span style="color: #007020">self</span>):
            <span style="color: #007020">self</span><span style="color: #333333">.</span>root <span style="color: #333333">=</span> <span style="color: #007020">None</span>
    
        <span style="color: #888888"># Insert node into BST.</span>
        <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">insertNode</span>(<span style="color: #007020">self</span>, val):
            node <span style="color: #333333">=</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>BSTreeNode(val)
            <span style="color: #008800; font-weight: bold">if</span> <span style="color: #000000; font-weight: bold">not</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>root:
                <span style="color: #007020">self</span><span style="color: #333333">.</span>root <span style="color: #333333">=</span> node
                <span style="color: #008800; font-weight: bold">return</span>
            curr <span style="color: #333333">=</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>root
            <span style="color: #008800; font-weight: bold">while</span> curr:
                <span style="color: #888888"># Insert left if smaller.</span>
                <span style="color: #008800; font-weight: bold">if</span> node<span style="color: #333333">.</span>val <span style="color: #333333">&lt;</span> curr<span style="color: #333333">.</span>val:
                    curr<span style="color: #333333">.</span>count <span style="color: #333333">+=</span> <span style="color: #0000DD; font-weight: bold">1</span>  <span style="color: #888888"># Increase the number of left children.</span>
                    <span style="color: #008800; font-weight: bold">if</span> curr<span style="color: #333333">.</span>left:
                        curr <span style="color: #333333">=</span> curr<span style="color: #333333">.</span>left;
                    <span style="color: #008800; font-weight: bold">else</span>:
                        curr<span style="color: #333333">.</span>left <span style="color: #333333">=</span> node;
                        <span style="color: #008800; font-weight: bold">break</span>
                <span style="color: #008800; font-weight: bold">else</span>:  <span style="color: #888888"># Insert right if larger or equal.</span>
                    <span style="color: #008800; font-weight: bold">if</span> curr<span style="color: #333333">.</span>right:
                        curr <span style="color: #333333">=</span> curr<span style="color: #333333">.</span>right
                    <span style="color: #008800; font-weight: bold">else</span>:
                        curr<span style="color: #333333">.</span>right <span style="color: #333333">=</span> node
                        <span style="color: #008800; font-weight: bold">break</span>
    
        <span style="color: #888888"># Query the smaller count of the value.</span>
        <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">query</span>(<span style="color: #007020">self</span>, val):
            count <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">0</span>
            curr <span style="color: #333333">=</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>root
            <span style="color: #008800; font-weight: bold">while</span> curr:
                <span style="color: #888888"># Insert left.</span>
                <span style="color: #008800; font-weight: bold">if</span> val <span style="color: #333333">&lt;</span> curr<span style="color: #333333">.</span>val:
                    curr <span style="color: #333333">=</span> curr<span style="color: #333333">.</span>left
                <span style="color: #008800; font-weight: bold">elif</span> val <span style="color: #333333">&gt;</span> curr<span style="color: #333333">.</span>val:
                    count <span style="color: #333333">+=</span> <span style="color: #0000DD; font-weight: bold">1</span> <span style="color: #333333">+</span> curr<span style="color: #333333">.</span>count  <span style="color: #888888"># Count the number of the smaller nodes.</span>
                    curr <span style="color: #333333">=</span> curr<span style="color: #333333">.</span>right
                <span style="color: #008800; font-weight: bold">else</span>:  <span style="color: #888888"># Equal.</span>
                    <span style="color: #008800; font-weight: bold">return</span> count <span style="color: #333333">+</span> curr<span style="color: #333333">.</span>count 
            <span style="color: #008800; font-weight: bold">return</span> <span style="color: #0000DD; font-weight: bold">0</span>
</pre></div>
