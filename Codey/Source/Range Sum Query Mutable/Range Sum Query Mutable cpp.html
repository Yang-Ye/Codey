<!-- HTML generated by Yang Ye --><div style="background: #ffffff; overflow:auto;width:auto;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span></span><span style="color: #888888">// Time:  ctor:   O(n),</span>
<span style="color: #888888">//        update: O(logn),</span>
<span style="color: #888888">//        query:  O(logn)</span>
<span style="color: #888888">// Space: O(n)</span>

<span style="color: #888888">// Binary Indexed Tree (BIT) solution.</span>
<span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">NumArray</span> {
<span style="color: #008800; font-weight: bold">public</span><span style="color: #333333">:</span>
    NumArray(vector<span style="color: #333333">&lt;</span><span style="color: #333399; font-weight: bold">int</span><span style="color: #333333">&gt;</span> <span style="color: #333333">&amp;</span>nums) <span style="color: #333333">:</span> nums_(nums) {
        bit_ <span style="color: #333333">=</span> vector<span style="color: #333333">&lt;</span><span style="color: #333399; font-weight: bold">int</span><span style="color: #333333">&gt;</span>(nums_.size() <span style="color: #333333">+</span> <span style="color: #0000DD; font-weight: bold">1</span>);
        <span style="color: #008800; font-weight: bold">for</span> (<span style="color: #333399; font-weight: bold">int</span> i <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">1</span>; i <span style="color: #333333">&lt;</span> bit_.size(); <span style="color: #333333">++</span>i) {
            bit_[i] <span style="color: #333333">=</span> nums[i <span style="color: #333333">-</span> <span style="color: #0000DD; font-weight: bold">1</span>] <span style="color: #333333">+</span> bit_[i <span style="color: #333333">-</span> <span style="color: #0000DD; font-weight: bold">1</span>];
        }
        <span style="color: #008800; font-weight: bold">for</span> (<span style="color: #333399; font-weight: bold">int</span> i <span style="color: #333333">=</span> bit_.size() <span style="color: #333333">-</span> <span style="color: #0000DD; font-weight: bold">1</span>; i <span style="color: #333333">&gt;=</span> <span style="color: #0000DD; font-weight: bold">1</span>; <span style="color: #333333">--</span>i) {
            <span style="color: #333399; font-weight: bold">int</span> last_i <span style="color: #333333">=</span> i <span style="color: #333333">-</span> lower_bit(i);
            bit_[i] <span style="color: #333333">-=</span> bit_[last_i];
        }
    }

    <span style="color: #333399; font-weight: bold">void</span> update(<span style="color: #333399; font-weight: bold">int</span> i, <span style="color: #333399; font-weight: bold">int</span> val) {
        <span style="color: #008800; font-weight: bold">if</span> (val <span style="color: #333333">-</span> nums_[i]) {
            add(i, val <span style="color: #333333">-</span> nums_[i]);
            nums_[i] <span style="color: #333333">=</span> val;
        }
    }

    <span style="color: #333399; font-weight: bold">int</span> sumRange(<span style="color: #333399; font-weight: bold">int</span> i, <span style="color: #333399; font-weight: bold">int</span> j) {
        <span style="color: #008800; font-weight: bold">return</span> sum(j) <span style="color: #333333">-</span> sum(i <span style="color: #333333">-</span> <span style="color: #0000DD; font-weight: bold">1</span>);
    }

<span style="color: #008800; font-weight: bold">private</span><span style="color: #333333">:</span>
    vector<span style="color: #333333">&lt;</span><span style="color: #333399; font-weight: bold">int</span><span style="color: #333333">&gt;</span> <span style="color: #333333">&amp;</span>nums_;
    vector<span style="color: #333333">&lt;</span><span style="color: #333399; font-weight: bold">int</span><span style="color: #333333">&gt;</span> bit_;

    <span style="color: #333399; font-weight: bold">int</span> <span style="color: #0066BB; font-weight: bold">sum</span>(<span style="color: #333399; font-weight: bold">int</span> i) {
        <span style="color: #333333">++</span>i;
        <span style="color: #333399; font-weight: bold">int</span> sum <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">0</span>;
        <span style="color: #008800; font-weight: bold">for</span> (; i <span style="color: #333333">&gt;</span> <span style="color: #0000DD; font-weight: bold">0</span>; i <span style="color: #333333">-=</span> lower_bit(i)) {
            sum <span style="color: #333333">+=</span> bit_[i];
        }
        <span style="color: #008800; font-weight: bold">return</span> sum;
    }

    <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">add</span>(<span style="color: #333399; font-weight: bold">int</span> i, <span style="color: #333399; font-weight: bold">int</span> val) {
        <span style="color: #333333">++</span>i;
        <span style="color: #008800; font-weight: bold">for</span> (; i <span style="color: #333333">&lt;=</span> nums_.size(); i <span style="color: #333333">+=</span> lower_bit(i)) {
            bit_[i] <span style="color: #333333">+=</span> val;
        }
    }

    <span style="color: #008800; font-weight: bold">inline</span> <span style="color: #333399; font-weight: bold">int</span> <span style="color: #0066BB; font-weight: bold">lower_bit</span>(<span style="color: #333399; font-weight: bold">int</span> i) {
        <span style="color: #008800; font-weight: bold">return</span> i <span style="color: #333333">&amp;</span> <span style="color: #333333">-</span>i;
    }
};

<span style="color: #888888">// Time:  ctor:   O(n),</span>
<span style="color: #888888">//        update: O(logn),</span>
<span style="color: #888888">//        query:  O(logn)</span>
<span style="color: #888888">// Space: O(n)</span>
<span style="color: #888888">// Segment Tree solution.</span>
<span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">NumArray2</span> {
<span style="color: #008800; font-weight: bold">public</span><span style="color: #333333">:</span>
    NumArray(vector<span style="color: #333333">&lt;</span><span style="color: #333399; font-weight: bold">int</span><span style="color: #333333">&gt;</span> <span style="color: #333333">&amp;</span>nums) <span style="color: #333333">:</span> nums_(nums) {
        root_ <span style="color: #333333">=</span> buildHelper(nums, <span style="color: #0000DD; font-weight: bold">0</span>, nums.size() <span style="color: #333333">-</span> <span style="color: #0000DD; font-weight: bold">1</span>);
    }
    
    <span style="color: #333399; font-weight: bold">void</span> update(<span style="color: #333399; font-weight: bold">int</span> i, <span style="color: #333399; font-weight: bold">int</span> val) {
        <span style="color: #008800; font-weight: bold">if</span> (nums_[i] <span style="color: #333333">!=</span> val) {
            nums_[i] <span style="color: #333333">=</span> val;
            updateHelper(root_, i, val);
        }
    }

    <span style="color: #333399; font-weight: bold">int</span> sumRange(<span style="color: #333399; font-weight: bold">int</span> i, <span style="color: #333399; font-weight: bold">int</span> j) {
        <span style="color: #008800; font-weight: bold">return</span> sumRangeHelper(root_, i, j);
    }

<span style="color: #008800; font-weight: bold">private</span><span style="color: #333333">:</span>
    vector<span style="color: #333333">&lt;</span><span style="color: #333399; font-weight: bold">int</span><span style="color: #333333">&gt;&amp;</span> nums_;

    <span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">SegmentTreeNode</span> {
    <span style="color: #008800; font-weight: bold">public</span><span style="color: #333333">:</span>
        <span style="color: #333399; font-weight: bold">int</span> start, end;
        <span style="color: #333399; font-weight: bold">int</span> sum;
        SegmentTreeNode <span style="color: #333333">*</span>left, <span style="color: #333333">*</span>right;
        SegmentTreeNode(<span style="color: #333399; font-weight: bold">int</span> i, <span style="color: #333399; font-weight: bold">int</span> j, <span style="color: #333399; font-weight: bold">int</span> s) <span style="color: #333333">:</span> 
            start(i), end(j), sum(s),
            left(<span style="color: #008800; font-weight: bold">nullptr</span>), right(<span style="color: #008800; font-weight: bold">nullptr</span>) {
        }
    };

    SegmentTreeNode <span style="color: #333333">*</span>root_;

    <span style="color: #888888">// Build segment tree.</span>
    SegmentTreeNode <span style="color: #333333">*</span><span style="color: #0066BB; font-weight: bold">buildHelper</span>(<span style="color: #008800; font-weight: bold">const</span> vector<span style="color: #333333">&lt;</span><span style="color: #333399; font-weight: bold">int</span><span style="color: #333333">&gt;&amp;</span> nums, <span style="color: #333399; font-weight: bold">int</span> start, <span style="color: #333399; font-weight: bold">int</span> end) {
        <span style="color: #008800; font-weight: bold">if</span> (start <span style="color: #333333">&gt;</span> end) {
            <span style="color: #008800; font-weight: bold">return</span> <span style="color: #008800; font-weight: bold">nullptr</span>;
        }

        <span style="color: #888888">// The root&#39;s start and end is given by build method.</span>
        SegmentTreeNode <span style="color: #333333">*</span>root <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">new</span> SegmentTreeNode(start, end, <span style="color: #0000DD; font-weight: bold">0</span>);

        <span style="color: #888888">// If start equals to end, there will be no children for this node.</span>
        <span style="color: #008800; font-weight: bold">if</span> (start <span style="color: #333333">==</span> end) {
            root<span style="color: #333333">-&gt;</span>sum <span style="color: #333333">=</span> nums[start];
            <span style="color: #008800; font-weight: bold">return</span> root;
        }

        <span style="color: #888888">// Left child: start=numsleft, end=(numsleft + numsright) / 2.</span>
        root<span style="color: #333333">-&gt;</span>left <span style="color: #333333">=</span> buildHelper(nums, start, (start <span style="color: #333333">+</span> end) <span style="color: #333333">/</span> <span style="color: #0000DD; font-weight: bold">2</span>);

        <span style="color: #888888">// Right child: start=(numsleft + numsright) / 2 + 1, end=numsright.</span>
        root<span style="color: #333333">-&gt;</span>right <span style="color: #333333">=</span> buildHelper(nums, (start <span style="color: #333333">+</span> end) <span style="color: #333333">/</span> <span style="color: #0000DD; font-weight: bold">2</span> <span style="color: #333333">+</span> <span style="color: #0000DD; font-weight: bold">1</span>, end);

        <span style="color: #888888">// Update sum.</span>
        root<span style="color: #333333">-&gt;</span>sum <span style="color: #333333">=</span> (root<span style="color: #333333">-&gt;</span>left <span style="color: #333333">!=</span> <span style="color: #008800; font-weight: bold">nullptr</span> <span style="color: #333333">?</span> root<span style="color: #333333">-&gt;</span>left<span style="color: #333333">-&gt;</span><span style="color: #997700; font-weight: bold">sum</span> : <span style="color: #0000DD; font-weight: bold">0</span>) <span style="color: #333333">+</span>
                    (root<span style="color: #333333">-&gt;</span>right <span style="color: #333333">!=</span> <span style="color: #008800; font-weight: bold">nullptr</span> <span style="color: #333333">?</span> root<span style="color: #333333">-&gt;</span>right<span style="color: #333333">-&gt;</span><span style="color: #997700; font-weight: bold">sum</span> : <span style="color: #0000DD; font-weight: bold">0</span>);
        <span style="color: #008800; font-weight: bold">return</span> root;
    }

    <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">updateHelper</span>(SegmentTreeNode <span style="color: #333333">*</span>root, <span style="color: #333399; font-weight: bold">int</span> i, <span style="color: #333399; font-weight: bold">int</span> val) {
        <span style="color: #888888">// Out of range.</span>
        <span style="color: #008800; font-weight: bold">if</span> (root <span style="color: #333333">==</span> <span style="color: #008800; font-weight: bold">nullptr</span> <span style="color: #333333">||</span> root<span style="color: #333333">-&gt;</span>start <span style="color: #333333">&gt;</span> i <span style="color: #333333">||</span> root<span style="color: #333333">-&gt;</span>end <span style="color: #333333">&lt;</span> i) {
            <span style="color: #008800; font-weight: bold">return</span>;
        }

        <span style="color: #888888">// Change the node&#39;s value with [i] to the new given value.</span>
        <span style="color: #008800; font-weight: bold">if</span> (root<span style="color: #333333">-&gt;</span>start <span style="color: #333333">==</span> i <span style="color: #333333">&amp;&amp;</span> root<span style="color: #333333">-&gt;</span>end <span style="color: #333333">==</span> i) {
            root<span style="color: #333333">-&gt;</span>sum <span style="color: #333333">=</span> val;
            <span style="color: #008800; font-weight: bold">return</span>;
        }

        updateHelper(root<span style="color: #333333">-&gt;</span>left, i, val);
        updateHelper(root<span style="color: #333333">-&gt;</span>right, i, val);

        <span style="color: #888888">// Update sum.</span>
        root<span style="color: #333333">-&gt;</span>sum <span style="color: #333333">=</span>  (root<span style="color: #333333">-&gt;</span>left <span style="color: #333333">!=</span> <span style="color: #008800; font-weight: bold">nullptr</span> <span style="color: #333333">?</span> root<span style="color: #333333">-&gt;</span>left<span style="color: #333333">-&gt;</span><span style="color: #997700; font-weight: bold">sum</span> : <span style="color: #0000DD; font-weight: bold">0</span>) <span style="color: #333333">+</span>
                     (root<span style="color: #333333">-&gt;</span>right <span style="color: #333333">!=</span> <span style="color: #008800; font-weight: bold">nullptr</span> <span style="color: #333333">?</span> root<span style="color: #333333">-&gt;</span>right<span style="color: #333333">-&gt;</span><span style="color: #997700; font-weight: bold">sum</span> : <span style="color: #0000DD; font-weight: bold">0</span>);
    }
    
    <span style="color: #333399; font-weight: bold">int</span> <span style="color: #0066BB; font-weight: bold">sumRangeHelper</span>(SegmentTreeNode <span style="color: #333333">*</span>root, <span style="color: #333399; font-weight: bold">int</span> start, <span style="color: #333399; font-weight: bold">int</span> end) {
        <span style="color: #888888">// Out of range.</span>
        <span style="color: #008800; font-weight: bold">if</span> (root <span style="color: #333333">==</span> <span style="color: #008800; font-weight: bold">nullptr</span> <span style="color: #333333">||</span> root<span style="color: #333333">-&gt;</span>start <span style="color: #333333">&gt;</span> end <span style="color: #333333">||</span> root<span style="color: #333333">-&gt;</span>end <span style="color: #333333">&lt;</span> start) {
            <span style="color: #008800; font-weight: bold">return</span> <span style="color: #0000DD; font-weight: bold">0</span>;
        }

        <span style="color: #888888">// Current segment is totally within range [start, end]</span>
        <span style="color: #008800; font-weight: bold">if</span> (root<span style="color: #333333">-&gt;</span>start <span style="color: #333333">&gt;=</span> start <span style="color: #333333">&amp;&amp;</span> root<span style="color: #333333">-&gt;</span>end <span style="color: #333333">&lt;=</span> end) {
            <span style="color: #008800; font-weight: bold">return</span> root<span style="color: #333333">-&gt;</span>sum;
        }

        <span style="color: #008800; font-weight: bold">return</span> sumRangeHelper(root<span style="color: #333333">-&gt;</span>left, start, end) <span style="color: #333333">+</span>
               sumRangeHelper(root<span style="color: #333333">-&gt;</span>right, start, end);
    }
};

<span style="color: #888888">// Your NumArray object will be instantiated and called as such:</span>
<span style="color: #888888">// NumArray numArray(nums);</span>
<span style="color: #888888">// numArray.sumRange(0, 1);</span>
<span style="color: #888888">// numArray.update(1, 10);</span>
<span style="color: #888888">// numArray.sumRange(1, 2);</span>
</pre></div>
