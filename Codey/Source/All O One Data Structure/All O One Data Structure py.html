<!-- HTML generated by Yang Ye --><div style="background: #ffffff; overflow:auto;width:auto;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span></span><span style="color: #888888"># Time:  O(1), per operation</span>
<span style="color: #888888"># Space: O(k)</span>

<span style="color: #888888"># Implement a data structure supporting the following operations:</span>
<span style="color: #888888">#</span>
<span style="color: #888888"># Inc(Key) - Inserts a new key with value 1. Or increments an existing key by 1.</span>
<span style="color: #888888"># Key is guaranteed to be a non-empty string.</span>
<span style="color: #888888"># Dec(Key) - If Key&#39;s value is 1, remove it from the data structure.</span>
<span style="color: #888888"># Otherwise decrements an existing key by 1. If the key does not exist,</span>
<span style="color: #888888"># this function does nothing. Key is guaranteed to be a non-empty string.</span>
<span style="color: #888888"># GetMaxKey() - Returns one of the keys with maximal value. If no element exists, return an empty string &quot;&quot;.</span>
<span style="color: #888888"># GetMinKey() - Returns one of the keys with minimal value. If no element exists, return an empty string &quot;&quot;.</span>
<span style="color: #888888"># Challenge: Perform all these in O(1) time complexity.</span>

<span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">Node</span>(<span style="color: #007020">object</span>):
    <span style="color: #DD4422">&quot;&quot;&quot;</span>
<span style="color: #DD4422">    double linked list node</span>
<span style="color: #DD4422">    &quot;&quot;&quot;</span>
    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">__init__</span>(<span style="color: #007020">self</span>, value, keys):
        <span style="color: #007020">self</span><span style="color: #333333">.</span>value <span style="color: #333333">=</span> value
        <span style="color: #007020">self</span><span style="color: #333333">.</span>keys <span style="color: #333333">=</span> keys
        <span style="color: #007020">self</span><span style="color: #333333">.</span>prev <span style="color: #333333">=</span> <span style="color: #007020">None</span>
        <span style="color: #007020">self</span><span style="color: #333333">.</span>next <span style="color: #333333">=</span> <span style="color: #007020">None</span>


<span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">LinkedList</span>(<span style="color: #007020">object</span>):
    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">__init__</span>(<span style="color: #007020">self</span>):
        <span style="color: #007020">self</span><span style="color: #333333">.</span>head, <span style="color: #007020">self</span><span style="color: #333333">.</span>tail <span style="color: #333333">=</span> Node(<span style="color: #0000DD; font-weight: bold">0</span>, <span style="color: #007020">set</span>()), Node(<span style="color: #0000DD; font-weight: bold">0</span>, <span style="color: #007020">set</span>())
        <span style="color: #007020">self</span><span style="color: #333333">.</span>head<span style="color: #333333">.</span>next, <span style="color: #007020">self</span><span style="color: #333333">.</span>tail<span style="color: #333333">.</span>prev <span style="color: #333333">=</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>tail, <span style="color: #007020">self</span><span style="color: #333333">.</span>head

    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">insert</span>(<span style="color: #007020">self</span>, pos, node):
        node<span style="color: #333333">.</span>prev, node<span style="color: #333333">.</span>next <span style="color: #333333">=</span> pos<span style="color: #333333">.</span>prev, pos
        pos<span style="color: #333333">.</span>prev<span style="color: #333333">.</span>next, pos<span style="color: #333333">.</span>prev <span style="color: #333333">=</span> node, node
        <span style="color: #008800; font-weight: bold">return</span> node

    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">erase</span>(<span style="color: #007020">self</span>, node):
        node<span style="color: #333333">.</span>prev<span style="color: #333333">.</span>next, node<span style="color: #333333">.</span>next<span style="color: #333333">.</span>prev <span style="color: #333333">=</span> node<span style="color: #333333">.</span>next, node<span style="color: #333333">.</span>prev
        <span style="color: #008800; font-weight: bold">del</span> node

    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">empty</span>(<span style="color: #007020">self</span>):
        <span style="color: #008800; font-weight: bold">return</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>head<span style="color: #333333">.</span>next <span style="color: #000000; font-weight: bold">is</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>tail
    
    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">begin</span>(<span style="color: #007020">self</span>):
        <span style="color: #008800; font-weight: bold">return</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>head<span style="color: #333333">.</span>next

    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">end</span>(<span style="color: #007020">self</span>):
        <span style="color: #008800; font-weight: bold">return</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>tail
    
    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">front</span>(<span style="color: #007020">self</span>):
        <span style="color: #008800; font-weight: bold">return</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>head<span style="color: #333333">.</span>next
    
    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">back</span>(<span style="color: #007020">self</span>):
        <span style="color: #008800; font-weight: bold">return</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>tail<span style="color: #333333">.</span>prev


<span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">AllOne</span>(<span style="color: #007020">object</span>):

    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">__init__</span>(<span style="color: #007020">self</span>):
        <span style="color: #DD4422">&quot;&quot;&quot;</span>
<span style="color: #DD4422">        Initialize your data structure here.</span>
<span style="color: #DD4422">        &quot;&quot;&quot;</span>
        <span style="color: #007020">self</span><span style="color: #333333">.</span>bucket_of_key <span style="color: #333333">=</span> {}
        <span style="color: #007020">self</span><span style="color: #333333">.</span>buckets <span style="color: #333333">=</span> LinkedList()

    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">inc</span>(<span style="color: #007020">self</span>, key):
        <span style="color: #DD4422">&quot;&quot;&quot;</span>
<span style="color: #DD4422">        Inserts a new key &lt;Key&gt; with value 1. Or increments an existing key by 1.</span>
<span style="color: #DD4422">        :type key: str</span>
<span style="color: #DD4422">        :rtype: void</span>
<span style="color: #DD4422">        &quot;&quot;&quot;</span>
        <span style="color: #008800; font-weight: bold">if</span> key <span style="color: #000000; font-weight: bold">not</span> <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>bucket_of_key:
            <span style="color: #007020">self</span><span style="color: #333333">.</span>bucket_of_key[key] <span style="color: #333333">=</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>buckets<span style="color: #333333">.</span>insert(<span style="color: #007020">self</span><span style="color: #333333">.</span>buckets<span style="color: #333333">.</span>begin(), Node(<span style="color: #0000DD; font-weight: bold">0</span>, <span style="color: #007020">set</span>([key])))
            
        bucket, next_bucket <span style="color: #333333">=</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>bucket_of_key[key], <span style="color: #007020">self</span><span style="color: #333333">.</span>bucket_of_key[key]<span style="color: #333333">.</span>next
        <span style="color: #008800; font-weight: bold">if</span> next_bucket <span style="color: #000000; font-weight: bold">is</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>buckets<span style="color: #333333">.</span>end() <span style="color: #000000; font-weight: bold">or</span> next_bucket<span style="color: #333333">.</span>value <span style="color: #333333">&gt;</span> bucket<span style="color: #333333">.</span>value<span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">1</span>:
            next_bucket <span style="color: #333333">=</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>buckets<span style="color: #333333">.</span>insert(next_bucket, Node(bucket<span style="color: #333333">.</span>value<span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">1</span>, <span style="color: #007020">set</span>()))
        next_bucket<span style="color: #333333">.</span>keys<span style="color: #333333">.</span>add(key)
        <span style="color: #007020">self</span><span style="color: #333333">.</span>bucket_of_key[key] <span style="color: #333333">=</span> next_bucket

        bucket<span style="color: #333333">.</span>keys<span style="color: #333333">.</span>remove(key)
        <span style="color: #008800; font-weight: bold">if</span> <span style="color: #000000; font-weight: bold">not</span> bucket<span style="color: #333333">.</span>keys:
            <span style="color: #007020">self</span><span style="color: #333333">.</span>buckets<span style="color: #333333">.</span>erase(bucket)

    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">dec</span>(<span style="color: #007020">self</span>, key):
        <span style="color: #DD4422">&quot;&quot;&quot;</span>
<span style="color: #DD4422">        Decrements an existing key by 1. If Key&#39;s value is 1, remove it from the data structure.</span>
<span style="color: #DD4422">        :type key: str</span>
<span style="color: #DD4422">        :rtype: void</span>
<span style="color: #DD4422">        &quot;&quot;&quot;</span>
        <span style="color: #008800; font-weight: bold">if</span> key <span style="color: #000000; font-weight: bold">not</span> <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>bucket_of_key:
            <span style="color: #008800; font-weight: bold">return</span>

        bucket, prev_bucket <span style="color: #333333">=</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>bucket_of_key[key], <span style="color: #007020">self</span><span style="color: #333333">.</span>bucket_of_key[key]<span style="color: #333333">.</span>prev
        <span style="color: #007020">self</span><span style="color: #333333">.</span>bucket_of_key<span style="color: #333333">.</span>pop(key, <span style="color: #007020">None</span>)
        <span style="color: #008800; font-weight: bold">if</span> bucket<span style="color: #333333">.</span>value <span style="color: #333333">&gt;</span> <span style="color: #0000DD; font-weight: bold">1</span>:
            <span style="color: #008800; font-weight: bold">if</span> bucket <span style="color: #000000; font-weight: bold">is</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>buckets<span style="color: #333333">.</span>begin() <span style="color: #000000; font-weight: bold">or</span> prev_bucket<span style="color: #333333">.</span>value <span style="color: #333333">&lt;</span> bucket<span style="color: #333333">.</span>value<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span>:
                prev_bucket <span style="color: #333333">=</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>buckets<span style="color: #333333">.</span>insert(bucket, Node(bucket<span style="color: #333333">.</span>value<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span>, <span style="color: #007020">set</span>()))
            prev_bucket<span style="color: #333333">.</span>keys<span style="color: #333333">.</span>add(key)
            <span style="color: #007020">self</span><span style="color: #333333">.</span>bucket_of_key[key] <span style="color: #333333">=</span> prev_bucket

        bucket<span style="color: #333333">.</span>keys<span style="color: #333333">.</span>remove(key)
        <span style="color: #008800; font-weight: bold">if</span> <span style="color: #000000; font-weight: bold">not</span> bucket<span style="color: #333333">.</span>keys:
            <span style="color: #007020">self</span><span style="color: #333333">.</span>buckets<span style="color: #333333">.</span>erase(bucket)

    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">getMaxKey</span>(<span style="color: #007020">self</span>):
        <span style="color: #DD4422">&quot;&quot;&quot;</span>
<span style="color: #DD4422">        Returns one of the keys with maximal value.</span>
<span style="color: #DD4422">        :rtype: str</span>
<span style="color: #DD4422">        &quot;&quot;&quot;</span>
        <span style="color: #008800; font-weight: bold">if</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>buckets<span style="color: #333333">.</span>empty():
            <span style="color: #008800; font-weight: bold">return</span> <span style="background-color: #fff0f0">&quot;&quot;</span>
        <span style="color: #008800; font-weight: bold">return</span> <span style="color: #007020">iter</span>(<span style="color: #007020">self</span><span style="color: #333333">.</span>buckets<span style="color: #333333">.</span>back()<span style="color: #333333">.</span>keys)<span style="color: #333333">.</span>next()

    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">getMinKey</span>(<span style="color: #007020">self</span>):
        <span style="color: #DD4422">&quot;&quot;&quot;</span>
<span style="color: #DD4422">        Returns one of the keys with Minimal value.</span>
<span style="color: #DD4422">        :rtype: str</span>
<span style="color: #DD4422">        &quot;&quot;&quot;</span>
        <span style="color: #008800; font-weight: bold">if</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>buckets<span style="color: #333333">.</span>empty():
            <span style="color: #008800; font-weight: bold">return</span> <span style="background-color: #fff0f0">&quot;&quot;</span>
        <span style="color: #008800; font-weight: bold">return</span> <span style="color: #007020">iter</span>(<span style="color: #007020">self</span><span style="color: #333333">.</span>buckets<span style="color: #333333">.</span>front()<span style="color: #333333">.</span>keys)<span style="color: #333333">.</span>next()
</pre></div>
