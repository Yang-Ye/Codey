<!-- HTML generated by Yang Ye --><div style="background: #ffffff; overflow:auto;width:auto;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span></span><span style="color: #888888"># Time:  O(m * n)</span>
<span style="color: #888888"># Space: O(m + n)</span>
<span style="color: #888888">#</span>
<span style="color: #888888"># The demons had captured the princess (P) and imprisoned her </span>
<span style="color: #888888"># in the bottom-right corner of a dungeon. T</span>
<span style="color: #888888"># he dungeon consists of M x N rooms laid out in a 2D grid. </span>
<span style="color: #888888"># Our valiant knight (K) was initially positioned in the top-left room </span>
<span style="color: #888888"># and must fight his way through the dungeon to rescue the princess.</span>
<span style="color: #888888"># </span>
<span style="color: #888888"># The knight has an initial health point represented by a positive integer. </span>
<span style="color: #888888"># If at any point his health point drops to 0 or below, he dies immediately.</span>
<span style="color: #888888"># </span>
<span style="color: #888888"># Some of the rooms are guarded by demons, </span>
<span style="color: #888888"># so the knight loses health (negative integers) upon entering these rooms; </span>
<span style="color: #888888"># other rooms are either empty (0&#39;s) or contain magic orbs that increase the knight&#39;s health (positive integers).</span>
<span style="color: #888888"># </span>
<span style="color: #888888"># In order to reach the princess as quickly as possible, </span>
<span style="color: #888888"># the knight decides to move only rightward or downward in each step.</span>
<span style="color: #888888"># </span>
<span style="color: #888888"># </span>
<span style="color: #888888"># Write a function to determine the knight&#39;s minimum initial health </span>
<span style="color: #888888"># so that he is able to rescue the princess.</span>
<span style="color: #888888"># </span>
<span style="color: #888888"># For example, given the dungeon below, the initial health of </span>
<span style="color: #888888"># the knight must be at least 7 if he follows the optimal path RIGHT-&gt; RIGHT -&gt; DOWN -&gt; DOWN.</span>
<span style="color: #888888"># </span>
<span style="color: #888888"># Notes:</span>
<span style="color: #888888"># </span>
<span style="color: #888888"># The knight&#39;s health has no upper bound.</span>
<span style="color: #888888"># Any room can contain threats or power-ups, even the first room the knight enters </span>
<span style="color: #888888"># and the bottom-right room where the princess is imprisoned.</span>
<span style="color: #888888">#</span>

<span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">Solution</span>:
    <span style="color: #888888"># @param dungeon, a list of lists of integers</span>
    <span style="color: #888888"># @return a integer</span>
    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">calculateMinimumHP</span>(<span style="color: #007020">self</span>, dungeon):
        DP <span style="color: #333333">=</span> [<span style="color: #007020">float</span>(<span style="background-color: #fff0f0">&quot;inf&quot;</span>) <span style="color: #008800; font-weight: bold">for</span> _ <span style="color: #000000; font-weight: bold">in</span> dungeon[<span style="color: #0000DD; font-weight: bold">0</span>]]
        DP[<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span>] <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">1</span>
        
        <span style="color: #008800; font-weight: bold">for</span> i <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">reversed</span>(<span style="color: #007020">xrange</span>(<span style="color: #007020">len</span>(dungeon))):
            DP[<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span>] <span style="color: #333333">=</span> <span style="color: #007020">max</span>(DP[<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span>] <span style="color: #333333">-</span> dungeon[i][<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span>], <span style="color: #0000DD; font-weight: bold">1</span>)
            <span style="color: #008800; font-weight: bold">for</span> j <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">reversed</span>(<span style="color: #007020">xrange</span>(<span style="color: #007020">len</span>(dungeon[i]) <span style="color: #333333">-</span> <span style="color: #0000DD; font-weight: bold">1</span>)):
                min_HP_on_exit <span style="color: #333333">=</span> <span style="color: #007020">min</span>(DP[j], DP[j <span style="color: #333333">+</span> <span style="color: #0000DD; font-weight: bold">1</span>])
                DP[j] <span style="color: #333333">=</span> <span style="color: #007020">max</span>(min_HP_on_exit <span style="color: #333333">-</span> dungeon[i][j], <span style="color: #0000DD; font-weight: bold">1</span>)
                
        <span style="color: #008800; font-weight: bold">return</span> DP[<span style="color: #0000DD; font-weight: bold">0</span>]

<span style="color: #888888"># Time:  O(m * n logk), where k is the possible maximum sum of loses </span>
<span style="color: #888888"># Space: O(m + n)</span>
<span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">Solution2</span>:
    <span style="color: #888888"># @param dungeon, a list of lists of integers</span>
    <span style="color: #888888"># @return a integer</span>
    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">calculateMinimumHP</span>(<span style="color: #007020">self</span>, dungeon):
        maximum_loses <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">0</span>
        <span style="color: #008800; font-weight: bold">for</span> rooms <span style="color: #000000; font-weight: bold">in</span> dungeon:
            <span style="color: #008800; font-weight: bold">for</span> room <span style="color: #000000; font-weight: bold">in</span> rooms:
                <span style="color: #008800; font-weight: bold">if</span> room <span style="color: #333333">&lt;</span> <span style="color: #0000DD; font-weight: bold">0</span>:
                    maximum_loses <span style="color: #333333">+=</span> <span style="color: #007020">abs</span>(room)
                    
        <span style="color: #008800; font-weight: bold">return</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>binarySearch(dungeon, maximum_loses)
    
    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">binarySearch</span>(<span style="color: #007020">self</span>, dungeon, maximum_loses):
        start, end <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">1</span>, maximum_loses <span style="color: #333333">+</span> <span style="color: #0000DD; font-weight: bold">1</span>
        result <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">0</span>
        <span style="color: #008800; font-weight: bold">while</span> start <span style="color: #333333">&lt;</span> end:
            mid <span style="color: #333333">=</span> start <span style="color: #333333">+</span> (end <span style="color: #333333">-</span> start) <span style="color: #333333">/</span> <span style="color: #0000DD; font-weight: bold">2</span>
            <span style="color: #008800; font-weight: bold">if</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>DP(dungeon, mid):
                end <span style="color: #333333">=</span> mid
            <span style="color: #008800; font-weight: bold">else</span>:
                start <span style="color: #333333">=</span> mid <span style="color: #333333">+</span> <span style="color: #0000DD; font-weight: bold">1</span>
        <span style="color: #008800; font-weight: bold">return</span> start
    
    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">DP</span>(<span style="color: #007020">self</span>, dungeon, HP):
        remain_HP <span style="color: #333333">=</span> [<span style="color: #0000DD; font-weight: bold">0</span> <span style="color: #008800; font-weight: bold">for</span> _ <span style="color: #000000; font-weight: bold">in</span> dungeon[<span style="color: #0000DD; font-weight: bold">0</span>]]
        remain_HP[<span style="color: #0000DD; font-weight: bold">0</span>] <span style="color: #333333">=</span> HP <span style="color: #333333">+</span> dungeon[<span style="color: #0000DD; font-weight: bold">0</span>][<span style="color: #0000DD; font-weight: bold">0</span>]
        <span style="color: #008800; font-weight: bold">for</span> j <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">xrange</span>(<span style="color: #0000DD; font-weight: bold">1</span>, <span style="color: #007020">len</span>(remain_HP)):
            <span style="color: #008800; font-weight: bold">if</span> remain_HP[j <span style="color: #333333">-</span> <span style="color: #0000DD; font-weight: bold">1</span>] <span style="color: #333333">&gt;</span> <span style="color: #0000DD; font-weight: bold">0</span>: 
                remain_HP[j] <span style="color: #333333">=</span> <span style="color: #007020">max</span>(remain_HP[j <span style="color: #333333">-</span> <span style="color: #0000DD; font-weight: bold">1</span>] <span style="color: #333333">+</span> dungeon[<span style="color: #0000DD; font-weight: bold">0</span>][j], <span style="color: #0000DD; font-weight: bold">0</span>)
                
        <span style="color: #008800; font-weight: bold">for</span> i <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">xrange</span>(<span style="color: #0000DD; font-weight: bold">1</span>, <span style="color: #007020">len</span>(dungeon)):
            <span style="color: #008800; font-weight: bold">if</span> remain_HP[<span style="color: #0000DD; font-weight: bold">0</span>] <span style="color: #333333">&gt;</span> <span style="color: #0000DD; font-weight: bold">0</span>:
                remain_HP[<span style="color: #0000DD; font-weight: bold">0</span>] <span style="color: #333333">=</span> <span style="color: #007020">max</span>(remain_HP[<span style="color: #0000DD; font-weight: bold">0</span>] <span style="color: #333333">+</span> dungeon[i][<span style="color: #0000DD; font-weight: bold">0</span>], <span style="color: #0000DD; font-weight: bold">0</span>)
            <span style="color: #008800; font-weight: bold">else</span>:
                remain_HP[<span style="color: #0000DD; font-weight: bold">0</span>] <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">0</span>
                
            <span style="color: #008800; font-weight: bold">for</span> j <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">xrange</span>(<span style="color: #0000DD; font-weight: bold">1</span>, <span style="color: #007020">len</span>(remain_HP)):
                remain <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">0</span>
                <span style="color: #008800; font-weight: bold">if</span> remain_HP[j <span style="color: #333333">-</span> <span style="color: #0000DD; font-weight: bold">1</span>] <span style="color: #333333">&gt;</span> <span style="color: #0000DD; font-weight: bold">0</span>:
                    remain <span style="color: #333333">=</span> <span style="color: #007020">max</span>(remain_HP[j <span style="color: #333333">-</span> <span style="color: #0000DD; font-weight: bold">1</span>] <span style="color: #333333">+</span> dungeon[i][j], remain)
                <span style="color: #008800; font-weight: bold">if</span> remain_HP[j] <span style="color: #333333">&gt;</span> <span style="color: #0000DD; font-weight: bold">0</span>:
                    remain <span style="color: #333333">=</span> <span style="color: #007020">max</span>(remain_HP[j] <span style="color: #333333">+</span> dungeon[i][j], remain)
                remain_HP[j] <span style="color: #333333">=</span> remain

        <span style="color: #008800; font-weight: bold">return</span> remain_HP[<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span>] <span style="color: #333333">&gt;</span> <span style="color: #0000DD; font-weight: bold">0</span>

<span style="color: #008800; font-weight: bold">if</span> __name__ <span style="color: #333333">==</span> <span style="background-color: #fff0f0">&quot;__main__&quot;</span>:
    dungeon <span style="color: #333333">=</span> [[ <span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">2</span>,  <span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">3</span>,  <span style="color: #0000DD; font-weight: bold">3</span>], \
               [ <span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">5</span>, <span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">10</span>,  <span style="color: #0000DD; font-weight: bold">1</span>], \
               [ <span style="color: #0000DD; font-weight: bold">10</span>,  <span style="color: #0000DD; font-weight: bold">30</span>, <span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">5</span>]]
    <span style="color: #008800; font-weight: bold">print</span> Solution()<span style="color: #333333">.</span>calculateMinimumHP(dungeon)
    
    dungeon <span style="color: #333333">=</span> [[ <span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">200</span>]]
    <span style="color: #008800; font-weight: bold">print</span> Solution()<span style="color: #333333">.</span>calculateMinimumHP(dungeon)
    
    dungeon <span style="color: #333333">=</span> [[<span style="color: #0000DD; font-weight: bold">0</span>, <span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">3</span>]]
    <span style="color: #008800; font-weight: bold">print</span> Solution()<span style="color: #333333">.</span>calculateMinimumHP(dungeon)
</pre></div>
