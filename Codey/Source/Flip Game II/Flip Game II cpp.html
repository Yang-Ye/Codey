<!-- HTML generated by Yang Ye --><div style="background: #ffffff; overflow:auto;width:auto;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span></span><span style="color: #888888">// Time:  O(n + c^2), c is max length of consecutive &#39;+&#39;</span>
<span style="color: #888888">// Space: O(c)</span>

<span style="color: #888888">// The best theory solution (DP, O(n + c^2)) could be seen here:</span>
<span style="color: #888888">// https://leetcode.com/discuss/64344/theory-matters-from-backtracking-128ms-to-dp-0ms</span>
<span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">Solution</span> {
<span style="color: #008800; font-weight: bold">public</span><span style="color: #333333">:</span>
    <span style="color: #333399; font-weight: bold">bool</span> canWin(string s) {
        replace(s.begin(), s.end(), <span style="color: #0044DD">&#39;-&#39;</span>, <span style="color: #0044DD">&#39; &#39;</span>);
        istringstream <span style="color: #0066BB; font-weight: bold">in</span>(s);
        <span style="color: #333399; font-weight: bold">int</span> g_final <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">0</span>;
        vector<span style="color: #333333">&lt;</span><span style="color: #333399; font-weight: bold">int</span><span style="color: #333333">&gt;</span> g;  <span style="color: #888888">// Sprague-Grundy function of 0 ~ maxlen, O(n) space</span>
        <span style="color: #008800; font-weight: bold">for</span> (string t; in <span style="color: #333333">&gt;&gt;</span> t; ) {  <span style="color: #888888">// Split the string</span>
            <span style="color: #333399; font-weight: bold">int</span> p <span style="color: #333333">=</span> t.size();
            <span style="color: #008800; font-weight: bold">while</span> (g.size() <span style="color: #333333">&lt;=</span> p) {  <span style="color: #888888">// O(c) time</span>
                string x{t};
                <span style="color: #333399; font-weight: bold">int</span> i <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">0</span>, j <span style="color: #333333">=</span> g.size() <span style="color: #333333">-</span> <span style="color: #0000DD; font-weight: bold">2</span>;
                <span style="color: #008800; font-weight: bold">while</span> (i <span style="color: #333333">&lt;=</span> j) {  <span style="color: #888888">// The S-G value of all subgame states, O(c) time</span>
                    <span style="color: #888888">// Theorem 2: g[game] = g[subgame1]^g[subgame2]^g[subgame3]...;</span>
                    x[g[i<span style="color: #333333">++</span>] <span style="color: #333333">^</span> g[j<span style="color: #333333">--</span>]] <span style="color: #333333">=</span> <span style="color: #0044DD">&#39;-&#39;</span>;
                }
                <span style="color: #888888">// Find first missing number.</span>
                g.emplace_back(x.find(<span style="color: #0044DD">&#39;+&#39;</span>));
            }
            g_final <span style="color: #333333">^=</span> g[p];
        }
        <span style="color: #008800; font-weight: bold">return</span> g_final;  <span style="color: #888888">// Theorem 1: First player must win iff g(current_state) != 0</span>
    }
};


<span style="color: #888888">// Time:  O(n + c^3 * 2^c * logc), n is length of string, c is count of &quot;++&quot;</span>
<span style="color: #888888">// Space: O(c * 2^c)</span>
<span style="color: #888888">// hash solution.</span>
<span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">Solution2</span> {
<span style="color: #008800; font-weight: bold">public</span><span style="color: #333333">:</span>
    <span style="color: #008800; font-weight: bold">struct</span> multiset_hash {
        std<span style="color: #333333">::</span><span style="color: #333399; font-weight: bold">size_t</span> <span style="color: #008800; font-weight: bold">operator</span>() (<span style="color: #008800; font-weight: bold">const</span> multiset<span style="color: #333333">&lt;</span><span style="color: #333399; font-weight: bold">int</span><span style="color: #333333">&gt;&amp;</span> set) <span style="color: #008800; font-weight: bold">const</span> {
            string set_string;
            <span style="color: #008800; font-weight: bold">for</span> (<span style="color: #008800; font-weight: bold">const</span> <span style="color: #008800; font-weight: bold">auto</span><span style="color: #333333">&amp;</span> <span style="color: #997700; font-weight: bold">i</span> : set) {
                set_string.append(to_string(i) <span style="color: #333333">+</span> <span style="background-color: #fff0f0">&quot; &quot;</span>);
            }
            <span style="color: #008800; font-weight: bold">return</span> hash<span style="color: #333333">&lt;</span>string<span style="color: #333333">&gt;</span>()(set_string); 
        }
    };

    <span style="color: #333399; font-weight: bold">bool</span> <span style="color: #0066BB; font-weight: bold">canWin</span>(string s) {
        <span style="color: #008800; font-weight: bold">const</span> <span style="color: #333399; font-weight: bold">int</span> n <span style="color: #333333">=</span> s.length();
        multiset<span style="color: #333333">&lt;</span><span style="color: #333399; font-weight: bold">int</span><span style="color: #333333">&gt;</span> consecutives;
        <span style="color: #008800; font-weight: bold">for</span> (<span style="color: #333399; font-weight: bold">int</span> i <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">0</span>; i <span style="color: #333333">&lt;</span> n <span style="color: #333333">-</span> <span style="color: #0000DD; font-weight: bold">1</span>; <span style="color: #333333">++</span>i) {  <span style="color: #888888">// O(n) time</span>
            <span style="color: #008800; font-weight: bold">if</span> (s[i] <span style="color: #333333">==</span> <span style="color: #0044DD">&#39;+&#39;</span>) {
                <span style="color: #333399; font-weight: bold">int</span> c <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">1</span>;
                <span style="color: #008800; font-weight: bold">for</span> (; i <span style="color: #333333">&lt;</span> n <span style="color: #333333">-</span> <span style="color: #0000DD; font-weight: bold">1</span> <span style="color: #333333">&amp;&amp;</span> s[i <span style="color: #333333">+</span> <span style="color: #0000DD; font-weight: bold">1</span>] <span style="color: #333333">==</span> <span style="color: #0044DD">&#39;+&#39;</span>; <span style="color: #333333">++</span>i, <span style="color: #333333">++</span>c);
                <span style="color: #008800; font-weight: bold">if</span> (c <span style="color: #333333">&gt;=</span> <span style="color: #0000DD; font-weight: bold">2</span>) {
                    consecutives.emplace(c);
                }
            }
        }
        <span style="color: #008800; font-weight: bold">return</span> canWinHelper(consecutives);
    }

<span style="color: #008800; font-weight: bold">private</span><span style="color: #333333">:</span>
    <span style="color: #333399; font-weight: bold">bool</span> canWinHelper(<span style="color: #008800; font-weight: bold">const</span> multiset<span style="color: #333333">&lt;</span><span style="color: #333399; font-weight: bold">int</span><span style="color: #333333">&gt;&amp;</span> consecutives) {  <span style="color: #888888">// O(2^c) time</span>
        <span style="color: #008800; font-weight: bold">if</span> (<span style="color: #333333">!</span>lookup_.count(consecutives)) {
            <span style="color: #333399; font-weight: bold">bool</span> is_win <span style="color: #333333">=</span> <span style="color: #007020">false</span>;
            <span style="color: #008800; font-weight: bold">for</span> (<span style="color: #008800; font-weight: bold">auto</span> it <span style="color: #333333">=</span> consecutives.cbegin(); <span style="color: #333333">!</span>is_win <span style="color: #333333">&amp;&amp;</span> it <span style="color: #333333">!=</span> consecutives.cend(); <span style="color: #333333">++</span>it) {  <span style="color: #888888">// O(c) time</span>
                <span style="color: #008800; font-weight: bold">const</span> <span style="color: #333399; font-weight: bold">int</span> c <span style="color: #333333">=</span> <span style="color: #333333">*</span>it;
                multiset<span style="color: #333333">&lt;</span><span style="color: #333399; font-weight: bold">int</span><span style="color: #333333">&gt;</span> next_consecutives(consecutives);
                next_consecutives.erase(next_consecutives.find(c));
                <span style="color: #008800; font-weight: bold">for</span> (<span style="color: #333399; font-weight: bold">int</span> i <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">0</span>; <span style="color: #333333">!</span>is_win <span style="color: #333333">&amp;&amp;</span> i <span style="color: #333333">&lt;</span> c <span style="color: #333333">-</span> <span style="color: #0000DD; font-weight: bold">1</span>; <span style="color: #333333">++</span>i) {  <span style="color: #888888">// O(clogc) time</span>
                    <span style="color: #008800; font-weight: bold">if</span> (i <span style="color: #333333">&gt;=</span> <span style="color: #0000DD; font-weight: bold">2</span>) {
                        next_consecutives.emplace(i);
                    }
                    <span style="color: #008800; font-weight: bold">if</span> (c <span style="color: #333333">-</span> <span style="color: #0000DD; font-weight: bold">2</span> <span style="color: #333333">-</span> i <span style="color: #333333">&gt;=</span> <span style="color: #0000DD; font-weight: bold">2</span>) {
                        next_consecutives.emplace(c <span style="color: #333333">-</span> <span style="color: #0000DD; font-weight: bold">2</span> <span style="color: #333333">-</span> i);
                    }
                    is_win <span style="color: #333333">=</span> <span style="color: #333333">!</span>canWinHelper(next_consecutives);
                    <span style="color: #008800; font-weight: bold">if</span> (i <span style="color: #333333">&gt;=</span> <span style="color: #0000DD; font-weight: bold">2</span>) {
                        next_consecutives.erase(next_consecutives.find(i));
                    }
                    <span style="color: #008800; font-weight: bold">if</span> (c <span style="color: #333333">-</span> <span style="color: #0000DD; font-weight: bold">2</span> <span style="color: #333333">-</span> i <span style="color: #333333">&gt;=</span> <span style="color: #0000DD; font-weight: bold">2</span>) {
                        next_consecutives.erase(next_consecutives.find(c <span style="color: #333333">-</span> <span style="color: #0000DD; font-weight: bold">2</span> <span style="color: #333333">-</span> i));
                    }
                    lookup_[consecutives] <span style="color: #333333">=</span> is_win;  <span style="color: #888888">// O(c) time</span>
                }
            }
        }
        <span style="color: #008800; font-weight: bold">return</span> lookup_[consecutives];
    }
    unordered_map<span style="color: #333333">&lt;</span>multiset<span style="color: #333333">&lt;</span><span style="color: #333399; font-weight: bold">int</span><span style="color: #333333">&gt;</span>, <span style="color: #333399; font-weight: bold">bool</span>, multiset_hash<span style="color: #333333">&gt;</span> lookup_;
};


<span style="color: #888888">// Time:  O(n + c * n * 2^c), try all the possible game strings,</span>
<span style="color: #888888">//                            and each string would have c choices to become the next string </span>
<span style="color: #888888">// Space: O(n * 2^c), keep all the possible game strings</span>
<span style="color: #888888">// hash solution.</span>
<span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">Solution3</span> {
<span style="color: #008800; font-weight: bold">public</span><span style="color: #333333">:</span>
    <span style="color: #333399; font-weight: bold">bool</span> canWin(string s) {
        <span style="color: #008800; font-weight: bold">if</span> (<span style="color: #333333">!</span>lookup_.count(s)) {
            <span style="color: #008800; font-weight: bold">const</span> <span style="color: #333399; font-weight: bold">int</span> n <span style="color: #333333">=</span> s.length();
            <span style="color: #333399; font-weight: bold">bool</span> is_win <span style="color: #333333">=</span> <span style="color: #007020">false</span>; 
            <span style="color: #008800; font-weight: bold">for</span> (<span style="color: #333399; font-weight: bold">int</span> i <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">0</span>; <span style="color: #333333">!</span>is_win <span style="color: #333333">&amp;&amp;</span> i <span style="color: #333333">&lt;</span> n <span style="color: #333333">-</span> <span style="color: #0000DD; font-weight: bold">1</span>; <span style="color: #333333">++</span>i) {
                <span style="color: #008800; font-weight: bold">if</span> (s[i] <span style="color: #333333">==</span> <span style="color: #0044DD">&#39;+&#39;</span>) {
                    <span style="color: #008800; font-weight: bold">for</span> (; <span style="color: #333333">!</span>is_win <span style="color: #333333">&amp;&amp;</span> i <span style="color: #333333">&lt;</span> n <span style="color: #333333">-</span> <span style="color: #0000DD; font-weight: bold">1</span> <span style="color: #333333">&amp;&amp;</span> s[i <span style="color: #333333">+</span> <span style="color: #0000DD; font-weight: bold">1</span>] <span style="color: #333333">==</span> <span style="color: #0044DD">&#39;+&#39;</span>; <span style="color: #333333">++</span>i) {
                        s[i] <span style="color: #333333">=</span> s[i <span style="color: #333333">+</span> <span style="color: #0000DD; font-weight: bold">1</span>] <span style="color: #333333">=</span> <span style="color: #0044DD">&#39;-&#39;</span>;
                        is_win <span style="color: #333333">=</span> <span style="color: #333333">!</span>canWin(s); 
                        s[i] <span style="color: #333333">=</span> s[i <span style="color: #333333">+</span> <span style="color: #0000DD; font-weight: bold">1</span>] <span style="color: #333333">=</span> <span style="color: #0044DD">&#39;+&#39;</span>;
                        lookup_[s] <span style="color: #333333">=</span> is_win;
                    }
                }
            }
        }
        <span style="color: #008800; font-weight: bold">return</span> lookup_[s];  
    }
<span style="color: #008800; font-weight: bold">private</span><span style="color: #333333">:</span>
    unordered_map<span style="color: #333333">&lt;</span>string, <span style="color: #333399; font-weight: bold">bool</span><span style="color: #333333">&gt;</span> lookup_;
};


<span style="color: #888888">// Time:  O(n * c!), n is length of string, c is count of &quot;++&quot;</span>
<span style="color: #888888">// Space: O(c), recursion would be called at most c in depth.</span>
<span style="color: #888888">//              Besides, no extra space in each depth for the modified string.</span>
<span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">Solution4</span> {
<span style="color: #008800; font-weight: bold">public</span><span style="color: #333333">:</span>
    <span style="color: #333399; font-weight: bold">bool</span> canWin(string s) {
        <span style="color: #008800; font-weight: bold">const</span> <span style="color: #333399; font-weight: bold">int</span> n <span style="color: #333333">=</span> s.length();
        <span style="color: #333399; font-weight: bold">bool</span> is_win <span style="color: #333333">=</span> <span style="color: #007020">false</span>; 
        <span style="color: #008800; font-weight: bold">for</span> (<span style="color: #333399; font-weight: bold">int</span> i <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">0</span>; <span style="color: #333333">!</span>is_win <span style="color: #333333">&amp;&amp;</span> i <span style="color: #333333">&lt;</span> n <span style="color: #333333">-</span> <span style="color: #0000DD; font-weight: bold">1</span>; <span style="color: #333333">++</span>i) {  <span style="color: #888888">// O(n) time</span>
            <span style="color: #008800; font-weight: bold">if</span> (s[i] <span style="color: #333333">==</span> <span style="color: #0044DD">&#39;+&#39;</span>) {
                <span style="color: #008800; font-weight: bold">for</span> (; <span style="color: #333333">!</span>is_win <span style="color: #333333">&amp;&amp;</span> i <span style="color: #333333">&lt;</span> n <span style="color: #333333">-</span> <span style="color: #0000DD; font-weight: bold">1</span> <span style="color: #333333">&amp;&amp;</span> s[i <span style="color: #333333">+</span> <span style="color: #0000DD; font-weight: bold">1</span>] <span style="color: #333333">==</span> <span style="color: #0044DD">&#39;+&#39;</span>; <span style="color: #333333">++</span>i) {  <span style="color: #888888">// O(c) time</span>
                    s[i] <span style="color: #333333">=</span> s[i <span style="color: #333333">+</span> <span style="color: #0000DD; font-weight: bold">1</span>] <span style="color: #333333">=</span> <span style="color: #0044DD">&#39;-&#39;</span>;
                    <span style="color: #888888">// t(n, c) = c * t(n, c - 1) + n = ... = c! * t(n, 0) + n * c! * (1/0! + 1/1! + ... 1/c!)</span>
                    <span style="color: #888888">// = n * c! + n * c! * O(e) = O(n * c!)</span>
                    is_win <span style="color: #333333">=</span> <span style="color: #333333">!</span>canWin(s); 
                     s[i] <span style="color: #333333">=</span> s[i <span style="color: #333333">+</span> <span style="color: #0000DD; font-weight: bold">1</span>] <span style="color: #333333">=</span> <span style="color: #0044DD">&#39;+&#39;</span>;
                }
            }
        }
        <span style="color: #008800; font-weight: bold">return</span> is_win;  
    }
};
</pre></div>
