<!-- HTML generated by Yang Ye --><div style="background: #ffffff; overflow:auto;width:auto;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span></span><span style="color: #888888"># Time:  O(n * k^2), n is the number of the words, k is the max length of the words.</span>
<span style="color: #888888"># Space: O(n * k)</span>

<span style="color: #888888"># Given a list of unique words. Find all pairs of indices (i, j)</span>
<span style="color: #888888"># in the given list, so that the concatenation of the two words, </span>
<span style="color: #888888"># i.e. words[i] + words[j] is a palindrome.</span>
<span style="color: #888888">#</span>
<span style="color: #888888"># Example 1:</span>
<span style="color: #888888"># Given words = [&quot;bat&quot;, &quot;tab&quot;, &quot;cat&quot;]</span>
<span style="color: #888888"># Return [[0, 1], [1, 0]]</span>
<span style="color: #888888"># The palindromes are [&quot;battab&quot;, &quot;tabbat&quot;]</span>
<span style="color: #888888"># Example 2:</span>
<span style="color: #888888"># Given words = [&quot;abcd&quot;, &quot;dcba&quot;, &quot;lls&quot;, &quot;s&quot;, &quot;sssll&quot;]</span>
<span style="color: #888888"># Return [[0, 1], [1, 0], [3, 2], [2, 4]]</span>
<span style="color: #888888"># The palindromes are [&quot;dcbaabcd&quot;, &quot;abcddcba&quot;, &quot;slls&quot;, &quot;llssssll&quot;]</span>

<span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">Solution</span>(<span style="color: #007020">object</span>):
    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">palindromePairs</span>(<span style="color: #007020">self</span>, words):
        <span style="color: #DD4422">&quot;&quot;&quot;</span>
<span style="color: #DD4422">        :type words: List[str]</span>
<span style="color: #DD4422">        :rtype: List[List[int]]</span>
<span style="color: #DD4422">        &quot;&quot;&quot;</span>
        res <span style="color: #333333">=</span> [] 
        lookup <span style="color: #333333">=</span> {}
        <span style="color: #008800; font-weight: bold">for</span> i, word <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">enumerate</span>(words):
            lookup[word] <span style="color: #333333">=</span> i

        <span style="color: #008800; font-weight: bold">for</span> i <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">xrange</span>(<span style="color: #007020">len</span>(words)):
            <span style="color: #008800; font-weight: bold">for</span> j <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">xrange</span>(<span style="color: #007020">len</span>(words[i]) <span style="color: #333333">+</span> <span style="color: #0000DD; font-weight: bold">1</span>):
                prefix <span style="color: #333333">=</span> words[i][j:]
                suffix <span style="color: #333333">=</span> words[i][:j]
                <span style="color: #008800; font-weight: bold">if</span> prefix <span style="color: #333333">==</span> prefix[::<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span>] <span style="color: #000000; font-weight: bold">and</span> \
                   suffix[::<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span>] <span style="color: #000000; font-weight: bold">in</span> lookup <span style="color: #000000; font-weight: bold">and</span> lookup[suffix[::<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span>]] <span style="color: #333333">!=</span> i:
                    res<span style="color: #333333">.</span>append([i, lookup[suffix[::<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span>]]])
                <span style="color: #008800; font-weight: bold">if</span> j <span style="color: #333333">&gt;</span> <span style="color: #0000DD; font-weight: bold">0</span> <span style="color: #000000; font-weight: bold">and</span> suffix <span style="color: #333333">==</span> suffix[::<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span>] <span style="color: #000000; font-weight: bold">and</span> \
                   prefix[::<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span>] <span style="color: #000000; font-weight: bold">in</span> lookup <span style="color: #000000; font-weight: bold">and</span> lookup[prefix[::<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span>]] <span style="color: #333333">!=</span> i:
                    res<span style="color: #333333">.</span>append([lookup[prefix[::<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span>]], i])
        <span style="color: #008800; font-weight: bold">return</span> res

<span style="color: #888888"># Time:  O(n * k^2), n is the number of the words, k is the max length of the words.</span>
<span style="color: #888888"># Space: O(n * k^2)</span>
<span style="color: #888888"># Manacher solution.</span>
<span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">Solution_TLE</span>(<span style="color: #007020">object</span>):
    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">palindromePairs</span>(<span style="color: #007020">self</span>, words):
        <span style="color: #DD4422">&quot;&quot;&quot;</span>
<span style="color: #DD4422">        :type words: List[str]</span>
<span style="color: #DD4422">        :rtype: List[List[int]]</span>
<span style="color: #DD4422">        &quot;&quot;&quot;</span>
        <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">manacher</span>(s, P):
            <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">preProcess</span>(s):
                <span style="color: #008800; font-weight: bold">if</span> <span style="color: #000000; font-weight: bold">not</span> s:
                    <span style="color: #008800; font-weight: bold">return</span> [<span style="background-color: #fff0f0">&#39;^&#39;</span>, <span style="background-color: #fff0f0">&#39;$&#39;</span>]
                T <span style="color: #333333">=</span> [<span style="background-color: #fff0f0">&#39;^&#39;</span>]
                <span style="color: #008800; font-weight: bold">for</span> c <span style="color: #000000; font-weight: bold">in</span> s:
                    T <span style="color: #333333">+=</span>  [<span style="background-color: #fff0f0">&quot;#&quot;</span>, c]
                T <span style="color: #333333">+=</span> [<span style="background-color: #fff0f0">&#39;#&#39;</span>, <span style="background-color: #fff0f0">&#39;$&#39;</span>]
                <span style="color: #008800; font-weight: bold">return</span> T
    
            T <span style="color: #333333">=</span> preProcess(s)
            center, right <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">0</span>, <span style="color: #0000DD; font-weight: bold">0</span>
            <span style="color: #008800; font-weight: bold">for</span> i <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">xrange</span>(<span style="color: #0000DD; font-weight: bold">1</span>, <span style="color: #007020">len</span>(T) <span style="color: #333333">-</span> <span style="color: #0000DD; font-weight: bold">1</span>):
                i_mirror <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">2</span> <span style="color: #333333">*</span> center <span style="color: #333333">-</span> i
                <span style="color: #008800; font-weight: bold">if</span> right <span style="color: #333333">&gt;</span> i:
                    P[i] <span style="color: #333333">=</span> <span style="color: #007020">min</span>(right <span style="color: #333333">-</span> i, P[i_mirror])
                <span style="color: #008800; font-weight: bold">else</span>:
                    P[i] <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">0</span>
                <span style="color: #008800; font-weight: bold">while</span> T[i <span style="color: #333333">+</span> <span style="color: #0000DD; font-weight: bold">1</span> <span style="color: #333333">+</span> P[i]] <span style="color: #333333">==</span> T[i <span style="color: #333333">-</span> <span style="color: #0000DD; font-weight: bold">1</span> <span style="color: #333333">-</span> P[i]]:
                    P[i] <span style="color: #333333">+=</span> <span style="color: #0000DD; font-weight: bold">1</span>
                <span style="color: #008800; font-weight: bold">if</span> i <span style="color: #333333">+</span> P[i] <span style="color: #333333">&gt;</span> right:
                    center, right <span style="color: #333333">=</span> i, i <span style="color: #333333">+</span> P[i]

        prefix, suffix <span style="color: #333333">=</span> collections<span style="color: #333333">.</span>defaultdict(<span style="color: #007020">list</span>), collections<span style="color: #333333">.</span>defaultdict(<span style="color: #007020">list</span>)
        <span style="color: #008800; font-weight: bold">for</span> i, word <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">enumerate</span>(words):
            P <span style="color: #333333">=</span> [<span style="color: #0000DD; font-weight: bold">0</span>] <span style="color: #333333">*</span> (<span style="color: #0000DD; font-weight: bold">2</span> <span style="color: #333333">*</span> <span style="color: #007020">len</span>(word) <span style="color: #333333">+</span> <span style="color: #0000DD; font-weight: bold">3</span>)
            manacher(word, P)
            <span style="color: #008800; font-weight: bold">for</span> j <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">xrange</span>(<span style="color: #007020">len</span>(P)):
                <span style="color: #008800; font-weight: bold">if</span> j <span style="color: #333333">-</span> P[j] <span style="color: #333333">==</span> <span style="color: #0000DD; font-weight: bold">1</span>:
                    prefix[word[(j <span style="color: #333333">+</span> P[j]) <span style="color: #333333">/</span> <span style="color: #0000DD; font-weight: bold">2</span>:]]<span style="color: #333333">.</span>append(i)
                <span style="color: #008800; font-weight: bold">if</span> j <span style="color: #333333">+</span> P[j] <span style="color: #333333">==</span> <span style="color: #007020">len</span>(P) <span style="color: #333333">-</span> <span style="color: #0000DD; font-weight: bold">2</span>:
                    suffix[word[:(j <span style="color: #333333">-</span> P[j]) <span style="color: #333333">/</span> <span style="color: #0000DD; font-weight: bold">2</span>]]<span style="color: #333333">.</span>append(i)
        res <span style="color: #333333">=</span> []
        <span style="color: #008800; font-weight: bold">for</span> i, word <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">enumerate</span>(words):
            <span style="color: #008800; font-weight: bold">for</span> j <span style="color: #000000; font-weight: bold">in</span> prefix[word[::<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span>]]:
                <span style="color: #008800; font-weight: bold">if</span> j <span style="color: #333333">!=</span> i:
                    res<span style="color: #333333">.</span>append([i, j])
            <span style="color: #008800; font-weight: bold">for</span> j <span style="color: #000000; font-weight: bold">in</span> suffix[word[::<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span>]]:
                <span style="color: #008800; font-weight: bold">if</span> <span style="color: #007020">len</span>(word) <span style="color: #333333">!=</span> <span style="color: #007020">len</span>(words[j]):
                    res<span style="color: #333333">.</span>append([j, i])
        <span style="color: #008800; font-weight: bold">return</span> res


<span style="color: #888888"># Time:  O(n * k^2), n is the number of the words, k is the max length of the words.</span>
<span style="color: #888888"># Space: O(n * k)</span>
<span style="color: #888888"># Trie solution.</span>
<span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">TrieNode</span>:
    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">__init__</span>(<span style="color: #007020">self</span>):
        <span style="color: #007020">self</span><span style="color: #333333">.</span>word_idx <span style="color: #333333">=</span> <span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span>
        <span style="color: #007020">self</span><span style="color: #333333">.</span>leaves <span style="color: #333333">=</span> {}

    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">insert</span>(<span style="color: #007020">self</span>, word, i):
        cur <span style="color: #333333">=</span> <span style="color: #007020">self</span>
        <span style="color: #008800; font-weight: bold">for</span> c <span style="color: #000000; font-weight: bold">in</span> word:
            <span style="color: #008800; font-weight: bold">if</span> <span style="color: #000000; font-weight: bold">not</span> c <span style="color: #000000; font-weight: bold">in</span> cur<span style="color: #333333">.</span>leaves:
                cur<span style="color: #333333">.</span>leaves[c] <span style="color: #333333">=</span> TrieNode()
            cur <span style="color: #333333">=</span> cur<span style="color: #333333">.</span>leaves[c]
        cur<span style="color: #333333">.</span>word_idx <span style="color: #333333">=</span> i

    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">find</span>(<span style="color: #007020">self</span>, s, idx, res):
        cur <span style="color: #333333">=</span> <span style="color: #007020">self</span>
        <span style="color: #008800; font-weight: bold">for</span> i <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">reversed</span>(<span style="color: #007020">xrange</span>(<span style="color: #007020">len</span>(s))):
            <span style="color: #008800; font-weight: bold">if</span> s[i] <span style="color: #000000; font-weight: bold">in</span> cur<span style="color: #333333">.</span>leaves:
                cur <span style="color: #333333">=</span> cur<span style="color: #333333">.</span>leaves[s[i]]
                <span style="color: #008800; font-weight: bold">if</span> cur<span style="color: #333333">.</span>word_idx <span style="color: #000000; font-weight: bold">not</span> <span style="color: #000000; font-weight: bold">in</span> (<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span>, idx) <span style="color: #000000; font-weight: bold">and</span> \
                   <span style="color: #007020">self</span><span style="color: #333333">.</span>is_palindrome(s, i <span style="color: #333333">-</span> <span style="color: #0000DD; font-weight: bold">1</span>):
                    res<span style="color: #333333">.</span>append([cur<span style="color: #333333">.</span>word_idx, idx])
            <span style="color: #008800; font-weight: bold">else</span>:
                <span style="color: #008800; font-weight: bold">break</span>

    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">is_palindrome</span>(<span style="color: #007020">self</span>, s, j):
        i <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">0</span>
        <span style="color: #008800; font-weight: bold">while</span> i <span style="color: #333333">&lt;=</span> j:
            <span style="color: #008800; font-weight: bold">if</span> s[i] <span style="color: #333333">!=</span> s[j]:
                <span style="color: #008800; font-weight: bold">return</span> <span style="color: #007020">False</span>
            i <span style="color: #333333">+=</span> <span style="color: #0000DD; font-weight: bold">1</span>
            j <span style="color: #333333">-=</span> <span style="color: #0000DD; font-weight: bold">1</span>
        <span style="color: #008800; font-weight: bold">return</span> <span style="color: #007020">True</span>

<span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">Solution_MLE</span>(<span style="color: #007020">object</span>):
    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">palindromePairs</span>(<span style="color: #007020">self</span>, words):
        <span style="color: #DD4422">&quot;&quot;&quot;</span>
<span style="color: #DD4422">        :type words: List[str]</span>
<span style="color: #DD4422">        :rtype: List[List[int]]</span>
<span style="color: #DD4422">        &quot;&quot;&quot;</span>
        res <span style="color: #333333">=</span> []
        trie <span style="color: #333333">=</span> TrieNode()
        <span style="color: #008800; font-weight: bold">for</span> i <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">xrange</span>(<span style="color: #007020">len</span>(words)):
            trie<span style="color: #333333">.</span>insert(words[i], i)

        <span style="color: #008800; font-weight: bold">for</span> i <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">xrange</span>(<span style="color: #007020">len</span>(words)):
            trie<span style="color: #333333">.</span>find(words[i], i, res)

        <span style="color: #008800; font-weight: bold">return</span> res
</pre></div>
